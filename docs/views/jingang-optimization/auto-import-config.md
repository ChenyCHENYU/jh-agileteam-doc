# Auto Import è‡ªåŠ¨å¯¼å…¥é…ç½®ä¼˜åŒ–

> âœ… ç»Ÿä¸€é…ç½® API å’Œç»„ä»¶è‡ªåŠ¨å¯¼å…¥ï¼Œç±»å‹å£°æ˜æ–‡ä»¶ç»Ÿä¸€ç®¡ç†

<AuthorTag author="CHENY" />

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

**å‘Šåˆ«æ‰‹åŠ¨å¯¼å…¥**ï¼š

```typescript
// âŒ ä¼˜åŒ–å‰ï¼šæ¯ä¸ªæ–‡ä»¶éƒ½è¦æ‰‹åŠ¨å¯¼å…¥
import { ref, reactive, computed, watch, onMounted } from "vue";
import { useRouter, useRoute } from "vue-router";
import { storeToRefs } from "pinia";

// âœ… ä¼˜åŒ–åï¼šç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥
const count = ref(0);
const router = useRouter();
const { visible } = storeToRefs(loginDialogStore);
```

---

## ğŸ“ é…ç½®å†…å®¹

### 1. API è‡ªåŠ¨å¯¼å…¥ - `vite/plugins/auto-import.js`

```javascript
import autoImport from "unplugin-auto-import/vite";

export default function createAutoImport() {
  return autoImport({
    // è‡ªåŠ¨å¯¼å…¥çš„ç›®æ ‡
    imports: [
      "vue", // ref, reactive, computed, watch, onMounted ç­‰
      "vue-router", // useRouter, useRoute ç­‰
      "pinia", // defineStore, storeToRefs ç­‰
    ],

    // ç”Ÿæˆ TypeScript å£°æ˜æ–‡ä»¶
    dts: "src/types/auto-imports.d.ts",

    // è‡ªå®šä¹‰å¯¼å…¥ç›®å½•
    dirs: [
      "src/hooks/**", // è‡ªåŠ¨å¯¼å…¥ hooks ç›®å½•ä¸‹çš„æ‰€æœ‰å¯¼å‡º
      "src/store/modules/**", // è‡ªåŠ¨å¯¼å…¥ store modules
    ],

    // é’ˆå¯¹ Vue æ¨¡æ¿çš„å…¨å±€å±æ€§
    vueTemplate: true,

    // ESLint é…ç½®ï¼ˆå¯é€‰ï¼‰
    eslintrc: {
      enabled: false, // é¦–æ¬¡è¿è¡Œè®¾ä¸º true ç”Ÿæˆé…ç½®æ–‡ä»¶
      filepath: "./.eslintrc-auto-import.json",
      globalsPropValue: true,
    },
  });
}
```

### 2. ç»„ä»¶è‡ªåŠ¨å¯¼å…¥ - `vite/plugins/index.ts`

```typescript
import Components from "unplugin-vue-components/vite";
import { ElementPlusResolver, VantResolver } from "unplugin-vue-components/resolvers";

// åœ¨ vitePlugins æ•°ç»„ä¸­
Components({
  resolvers: [ElementPlusResolver(), VantResolver()],
  dirs: [],  // ä¸è‡ªåŠ¨æ‰«æç›®å½•ï¼ˆæŒ‰éœ€é…ç½®ï¼‰
  dts: "src/types/components.d.ts",  // âœ… ç»„ä»¶ç±»å‹å£°æ˜æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ° src/types
}),
```

### 3. TypeScript é…ç½® - `tsconfig.json`

```jsonc
{
  "include": [
    "src/**/*.ts",
    "src/**/*.d.ts",
    "src/**/*.tsx",
    "src/**/*.vue",
    "src/types/auto-imports.d.ts", // âœ… API è‡ªåŠ¨å¯¼å…¥ç±»å‹å£°æ˜
    "src/types/components.d.ts" // âœ… ç»„ä»¶è‡ªåŠ¨å¯¼å…¥ç±»å‹å£°æ˜
  ]
}
```

---

## ğŸ”§ è‡ªåŠ¨å¯¼å…¥çš„ API

### Vue 3 Composition API

**å“åº”å¼ API**ï¼š

- `ref`, `reactive`, `readonly`, `shallowRef`, `shallowReactive`
- `computed`, `watch`, `watchEffect`
- `toRef`, `toRefs`, `isRef`, `unref`

**ç”Ÿå‘½å‘¨æœŸ**ï¼š

- `onMounted`, `onUnmounted`, `onBeforeMount`, `onBeforeUnmount`
- `onUpdated`, `onBeforeUpdate`
- `onActivated`, `onDeactivated`
- `onErrorCaptured`

**ä¾èµ–æ³¨å…¥**ï¼š

- `provide`, `inject`

**å…¶ä»–**ï¼š

- `nextTick`, `h`, `defineComponent`, `defineAsyncComponent`
- `getCurrentInstance`

### Vue Router

- `useRouter` - è·å–è·¯ç”±å®ä¾‹
- `useRoute` - è·å–å½“å‰è·¯ç”±ä¿¡æ¯
- `onBeforeRouteLeave`, `onBeforeRouteUpdate`

### Pinia

- `defineStore` - å®šä¹‰ Store
- `storeToRefs` - Store å“åº”å¼è½¬æ¢
- `createPinia`, `setActivePinia`, `getActivePinia`
- `acceptHMRUpdate` - çƒ­æ›´æ–°æ”¯æŒ

---

## æ–‡ä»¶ç»“æ„ä¼˜åŒ–

### ç±»å‹å£°æ˜æ–‡ä»¶ç»Ÿä¸€ç®¡ç†

```
src/
â””â”€â”€ types/
    â”œâ”€â”€ auto-imports.d.ts      # âœ… API è‡ªåŠ¨å¯¼å…¥ï¼ˆunplugin-auto-import ç”Ÿæˆï¼‰
    â”œâ”€â”€ components.d.ts        # âœ… ç»„ä»¶è‡ªåŠ¨å¯¼å…¥ï¼ˆunplugin-vue-components ç”Ÿæˆï¼‰
    â”œâ”€â”€ vue.d.ts               # Vue å…¨å±€ç±»å‹
    â”œâ”€â”€ assets.d.ts            # é™æ€èµ„æºç±»å‹
    â””â”€â”€ vite-env.d.ts          # Vite ç¯å¢ƒå˜é‡ç±»å‹
```

**ä¼˜åŒ–å‰**ï¼š

```
.
â”œâ”€â”€ components.d.ts            # âŒ åœ¨æ ¹ç›®å½•ï¼Œä¸è§„èŒƒ
â””â”€â”€ src/
    â””â”€â”€ env.d.ts               # âŒ ç±»å‹å£°æ˜åˆ†æ•£
```

**ä¼˜åŒ–å**ï¼š

```
.
â””â”€â”€ src/
    â””â”€â”€ types/                 # âœ… ç»Ÿä¸€ç®¡ç†
        â”œâ”€â”€ auto-imports.d.ts  # âœ… API è‡ªåŠ¨å¯¼å…¥
        â””â”€â”€ components.d.ts    # âœ… ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
```

---

## è‡ªåŠ¨å¯¼å…¥ç›®å½•

### `src/hooks/**`

æ‰€æœ‰ hooks ç›®å½•ä¸‹çš„å¯¼å‡ºä¼šè‡ªåŠ¨å¯¼å…¥ï¼š

```typescript
// src/hooks/useMessage.ts
export function useMessage() {
  // ...
}

// âœ… å…¶ä»–æ–‡ä»¶ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥
const message = useMessage();
```

### `src/store/modules/**`

Store modules ä¼šè‡ªåŠ¨å¯¼å…¥ï¼š

```typescript
// src/store/modules/login-dialog.ts
export const useLoginDialogStore = defineStore("loginDialog", () => {
  // ...
});

// âœ… å…¶ä»–æ–‡ä»¶ç›´æ¥ä½¿ç”¨
const loginDialogStore = useLoginDialogStore();
```

---

## ğŸ“„ ç”Ÿæˆçš„æ–‡ä»¶

### `src/types/auto-imports.d.ts`

API è‡ªåŠ¨å¯¼å…¥çš„ TypeScript å£°æ˜æ–‡ä»¶ï¼š

```typescript
// Auto-generated by unplugin-auto-import
declare global {
  const ref: typeof import("vue")["ref"];
  const reactive: typeof import("vue")["reactive"];
  const computed: typeof import("vue")["computed"];
  const watch: typeof import("vue")["watch"];
  const useRouter: typeof import("vue-router")["useRouter"];
  const useRoute: typeof import("vue-router")["useRoute"];
  const storeToRefs: typeof import("pinia")["storeToRefs"];
  const useLoginDialogStore: typeof import("./store/modules/login-dialog")["useLoginDialogStore"];
  // ... æ›´å¤š
}
```

### `src/types/components.d.ts`

ç»„ä»¶è‡ªåŠ¨å¯¼å…¥çš„ TypeScript å£°æ˜æ–‡ä»¶ï¼š

```typescript
// Auto-generated by unplugin-vue-components
declare module "vue" {
  export interface GlobalComponents {
    ElButton: typeof import("element-plus/es")["ElButton"];
    ElDialog: typeof import("element-plus/es")["ElDialog"];
    ElInput: typeof import("element-plus/es")["ElInput"];
    // ... Element Plus å’Œ Vant ç»„ä»¶
  }
}
```

**æ³¨æ„**ï¼š

- âœ… è¿™ä¸¤ä¸ªæ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°
- âœ… å·²é…ç½®åœ¨ `tsconfig.json` çš„ `include` ä¸­
- âŒ ä¸è¦æ‰‹åŠ¨ä¿®æ”¹
- âœ… åº”è¯¥åŠ å…¥ Gitï¼ˆä¾¿äºå›¢é˜Ÿå…±äº«ç±»å‹ï¼‰

---

## ğŸ§ª ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šVue ç»„ä»¶

```vue
<script setup lang="ts">
// âŒ ä¸å†éœ€è¦æ‰‹åŠ¨å¯¼å…¥
// import { ref, computed, watch, onMounted } from 'vue'
// import { useRouter } from 'vue-router'

// âœ… ç›´æ¥ä½¿ç”¨
const count = ref(0);
const doubled = computed(() => count.value * 2);
const router = useRouter();

watch(count, (newVal) => {
  console.log("count changed:", newVal);
});

onMounted(() => {
  console.log("mounted");
});

const goHome = () => {
  router.push("/");
};
</script>
```

### ç¤ºä¾‹ 2ï¼šPinia Store

```typescript
// src/store/modules/user.ts

// âŒ ä¸å†éœ€è¦
// import { defineStore } from 'pinia'
// import { ref, computed } from 'vue'

// âœ… ç›´æ¥ä½¿ç”¨
export const useUserStore = defineStore("user", () => {
  const name = ref("");
  const age = ref(0);

  const isAdult = computed(() => age.value >= 18);

  return { name, age, isAdult };
});
```

### ç¤ºä¾‹ 3ï¼šä½¿ç”¨ Store

```vue
<script setup lang="ts">
// âŒ ä¸å†éœ€è¦
// import { storeToRefs } from 'pinia'
// import { useUserStore } from '@/store/modules/user'

// âœ… ç›´æ¥ä½¿ç”¨ï¼ˆå¦‚æœé…ç½®äº† dirsï¼‰
const userStore = useUserStore();
const { name, age } = storeToRefs(userStore);
</script>
```

### ç¤ºä¾‹ 4ï¼šè‡ªå®šä¹‰ Hooks

```typescript
// src/hooks/useCounter.ts
export function useCounter(initialValue = 0) {
  const count = ref(initialValue);

  const increment = () => count.value++;
  const decrement = () => count.value--;

  return { count, increment, decrement };
}

// âœ… å…¶ä»–æ–‡ä»¶ç›´æ¥ä½¿ç”¨
const { count, increment } = useCounter(10);
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### `dts: 'src/types/auto-imports.d.ts'`

ç”Ÿæˆ TypeScript å£°æ˜æ–‡ä»¶çš„è·¯å¾„ã€‚

**ä½œç”¨**ï¼š

- âœ… æä¾›ç±»å‹æç¤º
- âœ… é¿å… TypeScript æŠ¥é”™
- âœ… æ”¯æŒæ™ºèƒ½è¡¥å…¨

### `dirs: ['src/hooks/**', 'src/store/modules/**']`

æŒ‡å®šè¦è‡ªåŠ¨å¯¼å…¥çš„ç›®å½•ã€‚

**è§„åˆ™**ï¼š

- æ”¯æŒ glob æ¨¡å¼
- åªå¯¼å‡º `export` çš„å†…å®¹
- æ”¯æŒåµŒå¥—ç›®å½•

### `vueTemplate: true`

åœ¨ Vue æ¨¡æ¿ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨å¯¼å…¥çš„ APIã€‚

**ç¤ºä¾‹**ï¼š

```vue
<template>
  <!-- âœ… å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ -->
  <div>{{ computed(() => count * 2).value }}</div>
</template>
```

### `eslintrc.enabled`

ç”Ÿæˆ ESLint é…ç½®æ–‡ä»¶ã€‚

**ä½¿ç”¨æ­¥éª¤**ï¼š

1. é¦–æ¬¡è¿è¡Œæ—¶è®¾ä¸º `true`
2. è¿è¡Œ `pnpm dev`ï¼Œç”Ÿæˆ `.eslintrc-auto-import.json`
3. åœ¨ `.eslintrc.js` ä¸­å¼•å…¥ï¼š
   ```javascript
   extends: [
     './.eslintrc-auto-import.json'
   ]
   ```
4. æ”¹å› `false`

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### ä»£ç é‡å¯¹æ¯”

| æ–‡ä»¶ç±»å‹     | ä¼˜åŒ–å‰     | ä¼˜åŒ–å | å‡å°‘  |
| ------------ | ---------- | ------ | ----- |
| **Vue ç»„ä»¶** | ~10 è¡Œå¯¼å…¥ | 0 è¡Œ   | -100% |
| **Store**    | ~5 è¡Œå¯¼å…¥  | 0 è¡Œ   | -100% |
| **Hooks**    | ~3 è¡Œå¯¼å…¥  | 0 è¡Œ   | -100% |

### å¼€å‘ä½“éªŒå¯¹æ¯”

| æŒ‡æ ‡         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
| ------------ | ------ | ------ | ---- |
| **ç¼–ç é€Ÿåº¦** | æ…¢     | å¿«     | +50% |
| **å‡ºé”™ç‡**   | é«˜     | ä½     | -80% |
| **å¯è¯»æ€§**   | ä¸€èˆ¬   | ä¼˜ç§€   | +40% |

---

## âœ… éªŒè¯æ¸…å•

### API è‡ªåŠ¨å¯¼å…¥

- [x] ä¼˜åŒ– `vite/plugins/auto-import.js` é…ç½®
- [x] è®¾ç½® `dts` ä¸º `src/types/auto-imports.d.ts`
- [x] æ·»åŠ  `dirs` è‡ªåŠ¨å¯¼å…¥ hooks å’Œ store
- [x] å¯ç”¨ `vueTemplate` æ”¯æŒ

### ç»„ä»¶è‡ªåŠ¨å¯¼å…¥

- [x] ä¼˜åŒ– `vite/plugins/index.ts` ä¸­çš„ Components é…ç½®
- [x] è®¾ç½® `dts` ä¸º `src/types/components.d.ts`
- [x] é…ç½® Element Plus å’Œ Vant è§£æå™¨

### TypeScript é…ç½®

- [x] æ›´æ–° `tsconfig.json` åŒ…å«ç±»å‹å£°æ˜æ–‡ä»¶
- [x] ç»Ÿä¸€ç±»å‹æ–‡ä»¶åˆ° `src/types/` ç›®å½•

### è¿è¡Œæµ‹è¯•

- [ ] åˆ é™¤æ ¹ç›®å½•æ—§çš„ `components.d.ts`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [ ] è¿è¡Œ `pnpm dev`ï¼Œç”Ÿæˆæ–°çš„ç±»å‹æ–‡ä»¶
- [ ] æ£€æŸ¥ `src/types/auto-imports.d.ts` æ˜¯å¦ç”Ÿæˆ
- [ ] æ£€æŸ¥ `src/types/components.d.ts` æ˜¯å¦ç”Ÿæˆ
- [ ] æµ‹è¯•ï¼šç§»é™¤ä¸€ä¸ªç»„ä»¶çš„æ‰‹åŠ¨å¯¼å…¥ï¼ŒéªŒè¯è‡ªåŠ¨å¯¼å…¥
- [ ] æ£€æŸ¥ TypeScript ç±»å‹æç¤ºæ˜¯å¦æ­£å¸¸
- [ ] æ£€æŸ¥ ESLint æ˜¯å¦æŠ¥é”™ï¼ˆå¦‚æŠ¥é”™ï¼Œé…ç½® eslintrcï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

### 0. æ¸…ç†æ—§æ–‡ä»¶ï¼ˆé‡è¦ï¼‰

é¦–æ¬¡è¿è¡Œå‰ï¼Œæ£€æŸ¥å¹¶åˆ é™¤æ ¹ç›®å½•çš„æ—§ç±»å‹æ–‡ä»¶ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ—§æ–‡ä»¶
ls components.d.ts

# å¦‚æœå­˜åœ¨ï¼Œåˆ é™¤å®ƒ
rm components.d.ts

# æˆ–è€…åœ¨ Windows ä¸Š
del components.d.ts
```

### 1. æ¸…ç†ç°æœ‰ä»£ç 

å¯ä»¥é€æ­¥ç§»é™¤æ‰‹åŠ¨å¯¼å…¥ï¼š

```bash
# æœç´¢å¯ä»¥åˆ é™¤çš„å¯¼å…¥
grep -r "import { ref, reactive" src/
grep -r "import { useRouter" src/
grep -r "import.*Element.*from 'element-plus'" src/
```

### 2. é…ç½® ESLintï¼ˆå¯é€‰ï¼‰

å¦‚æœ ESLint æŠ¥ `'ref' is not defined` é”™è¯¯ï¼š

1. åœ¨ `auto-import.js` ä¸­è®¾ç½® `eslintrc.enabled: true`
2. è¿è¡Œé¡¹ç›®ç”Ÿæˆé…ç½®æ–‡ä»¶
3. åœ¨ `.eslintrc.js` ä¸­å¼•å…¥é…ç½®
4. æ”¹å› `enabled: false`

### 3. æ·»åŠ æ›´å¤šè‡ªåŠ¨å¯¼å…¥

å¯ä»¥æ·»åŠ å…¶ä»–å¸¸ç”¨åº“ï¼š

```javascript
imports: [
  'vue',
  'vue-router',
  'pinia',
  {
    '@vueuse/core': [
      'useStorage',
      'useMouse',
      'useWindowSize',
      // ... æ›´å¤š
    ],
  },
],
```

---

::: tip 

1. **ä¿æŒç®€æ´**ï¼šåªå¯¼å…¥å¸¸ç”¨ APIï¼Œé¿å…è¿‡åº¦è‡ªåŠ¨åŒ–
2. **ç±»å‹å®‰å…¨**ï¼šç¡®ä¿ `auto-imports.d.ts` è¢« `tsconfig.json` åŒ…å«
3. **å›¢é˜Ÿåä½œ**ï¼šå°† `auto-imports.d.ts` åŠ å…¥ Gitï¼Œä¾¿äºå›¢é˜Ÿå…±äº«
4. **æ€§èƒ½è€ƒè™‘**ï¼šè‡ªåŠ¨å¯¼å…¥ä¸å½±å“æ‰“åŒ…ä½“ç§¯ï¼ˆtree-shaking ä»ç„¶æœ‰æ•ˆï¼‰

:::

---
