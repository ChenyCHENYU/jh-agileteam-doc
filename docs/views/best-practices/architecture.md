# æ¶æ„è®¾è®¡

> **åŸºäºé‡‘æ’äº§å“åŒ–å¹³å°ç”Ÿäº§åŸŸåº”ç”¨ï¼ˆcx-ui-produceï¼‰çš„æ¶æ„è®¾è®¡ç»¼åˆæç‚¼**  
> æœ¬æ–‡æ¡£æ•´ç†äº†é¡¹ç›®å®é™…ä½¿ç”¨çš„æ¶æ„è®¾è®¡æ¨¡å¼ã€æŠ€æœ¯é€‰å‹ã€å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ


<AuthorTag :authors="['ZhuXiang','CHENY']" />

## 1. äº§å“åŒ–æ¶æ„è®¾è®¡

### 1.1 äº§å“åŒ–ç†å¿µ

**æ ¸å¿ƒæ€æƒ³**ï¼š**"ä¸€å¥—ä»£ç ï¼Œå¤šå¤„éƒ¨ç½²"** + **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**

```
äº§å“åŒ– = ç»Ÿä¸€æŠ€æœ¯æ ˆ + ç»Ÿä¸€è§„èŒƒ + ç‹¬ç«‹éƒ¨ç½² + çµæ´»ç»„è£… + ç›¸äº’è°ƒç”¨
```

**æ¶æ„åŸåˆ™**ï¼š

| åŸåˆ™           | è¯´æ˜                                                   | å®ç°æ–¹å¼                      |
| -------------- | ------------------------------------------------------ | ----------------------------- |
| ç»Ÿä¸€æŠ€æœ¯æ ˆ     | æ‰€æœ‰åº”ç”¨ä½¿ç”¨ Vue 3 + Vite + Element Plus + Pinia       | é€šè¿‡è„šæ‰‹æ¶å’Œè§„èŒƒçº¦æŸ          |
| ç»Ÿä¸€è§„èŒƒ       | ç»Ÿä¸€çš„ä»£ç è§„èŒƒã€ç›®å½•ç»“æ„ã€å¼€å‘æµç¨‹                     | æœ¬æ–‡æ¡£ + Lint å·¥å…·            |
| ç‹¬ç«‹éƒ¨ç½²       | æ¯ä¸ªåº”ç”¨ç‹¬ç«‹ Git ä»“åº“ã€ç‹¬ç«‹éƒ¨ç½²                        | ç‹¬ç«‹çš„ CI/CD æµç¨‹             |
| çµæ´»ç»„è£…       | é€šè¿‡å¾®å‰ç«¯æŒ‰éœ€ç»„è£…ï¼Œä¸åŒå®¢æˆ·å¯é€‰æ‹©ä¸åŒåº”ç”¨             | Module Federation             |
| ç›¸äº’è°ƒç”¨       | åº”ç”¨é—´å¯ä»¥è·¨åŸŸè°ƒç”¨é¡µé¢å’Œç»„ä»¶                           | Remote ç»„ä»¶åŠ è½½               |
| æŒ‰éœ€åŠ è½½       | è¿è¡Œæ—¶åŠ¨æ€åŠ è½½è¿œç¨‹æ¨¡å—ï¼Œå‡å°‘ä¸»åº”ç”¨ä½“ç§¯                 | åŠ¨æ€ import                   |
| é¢†åŸŸé©±åŠ¨       | æ¯ä¸ªåº”ç”¨å¯¹åº”ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ                               | DDD æ¶æ„è®¾è®¡                  |

### 1.2 å››å¤§åº”ç”¨çŸ©é˜µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é‡‘æ’äº§å“åŒ–å¹³å°                           â”‚
â”‚                  (JH4J Product Platform)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿäº§åº”ç”¨    â”‚  â”‚ é”€å”®åº”ç”¨ï¼ˆå½“å‰é¡¹ç›®ï¼‰  â”‚  â”‚ è´¨é‡åº”ç”¨         â”‚
â”‚cx-ui-produceâ”‚  â”‚  cx-ui-sale       â”‚  â”‚ cx-ui-quality   â”‚
â”‚             â”‚  â”‚                      â”‚  â”‚                 â”‚
â”‚ğŸ“¦ ç”Ÿäº§è®¡åˆ’   â”‚  â”‚ ğŸ›’ è®¢å•ç®¡ç†           â”‚  â”‚ ğŸ” è´¨é‡æ£€éªŒ      â”‚
â”‚ğŸ“¦ å·¥è‰ºç®¡ç†   â”‚  â”‚ ğŸ›’ å®¢æˆ·ç®¡ç†           â”‚  â”‚ ğŸ” è´¨é‡è·Ÿè¸ª      â”‚
â”‚ğŸ“¦ è®¾å¤‡ç®¡ç†   â”‚  â”‚ ğŸ›’ é”€å”®åˆ†æ           â”‚  â”‚ ğŸ” è´¨é‡æŠ¥è¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                       â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          å…±äº«å­åº”ç”¨ (Shared Apps)              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ systemApp    â”‚ agGridApp    â”‚ componentLib     â”‚
    â”‚ (ç³»ç»Ÿç®¡ç†)    â”‚ (é«˜çº§è¡¨æ ¼)    â”‚ (ç»„ä»¶åº“)          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Â· ç”¨æˆ·ç®¡ç†    â”‚ Â· é«˜çº§è¡¨æ ¼    â”‚ Â· ä¸šåŠ¡ç»„ä»¶        â”‚
    â”‚ Â· è§’è‰²æƒé™    â”‚ Â· æ•°æ®å¯¼å‡º    â”‚ Â· å›¾è¡¨ç»„ä»¶        â”‚
    â”‚ Â· èœå•ç®¡ç†    â”‚ Â· è™šæ‹Ÿæ»šåŠ¨    â”‚ Â· è¡¨å•ç»„ä»¶        â”‚
    â”‚ Â· ç»„ç»‡æ¶æ„    â”‚ Â· åˆ—å†»ç»“      â”‚ Â· å¸ƒå±€ç»„ä»¶        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åº”ç”¨èŒè´£çŸ©é˜µ**ï¼š

| åº”ç”¨              | ä»£ç ä»“åº“         | éƒ¨ç½²è·¯å¾„   | æ ¸å¿ƒé¢†åŸŸ     | ä¾èµ–å…³ç³»               |
| ----------------- | ---------------- | ---------- | ------------ | ---------------------- |
| **é”€å”®åº”ç”¨**      | cx-ui-produce    | `/main`    | é”€å”®åŸŸ       | systemApp + agGridApp  |
| **ç”Ÿäº§åº”ç”¨**      | cx-ui-produce    | `/produce` | ç”Ÿäº§åŸŸ       | systemApp + saleApp    |
| **è´¨é‡åº”ç”¨**      | cx-ui-quality    | `/quality` | è´¨é‡åŸŸ       | systemApp + produceApp |
| **æˆæœ¬åº”ç”¨**      | cx-ui-cost       | `/cost`    | æˆæœ¬åŸŸ       | systemApp + produceApp |
| **ç³»ç»Ÿç®¡ç†å­åº”ç”¨** | jh4j-systemApp   | `/sub/systemApp` | ç³»ç»Ÿç®¡ç† | è¢«æ‰€æœ‰åº”ç”¨ä¾èµ–         |
| **é«˜çº§è¡¨æ ¼å­åº”ç”¨** | jh4j-ag-grid     | `/sub/ag-grid`   | æ•°æ®è¡¨æ ¼ | è¢«æ‰€æœ‰åº”ç”¨ä¾èµ–         |

### 1.3 äº§å“åŒ–ä¼˜åŠ¿

**1. å¿«é€Ÿå¤åˆ¶**

```
æ–°å®¢æˆ·éœ€æ±‚ â†’ é€‰æ‹©åº”ç”¨æ¨¡å— â†’ ç‹¬ç«‹éƒ¨ç½² â†’ ä¸Šçº¿ä½¿ç”¨
```

- **åœºæ™¯ä¸¾ä¾‹**ï¼šå®¢æˆ· A åªéœ€é”€å”®+ç”Ÿäº§ï¼Œå®¢æˆ· B éœ€è¦å…¨éƒ¨æ¨¡å—
- **å®ç°æ–¹å¼**ï¼šå„åº”ç”¨ç‹¬ç«‹æ‰“åŒ…ï¼ŒæŒ‰éœ€éƒ¨ç½²

**2. æŒ‰éœ€å®šåˆ¶**

```
åŸºç¡€ç‰ˆï¼ˆé”€å”®+ç”Ÿäº§ï¼‰ â†’ æ ‡å‡†ç‰ˆï¼ˆ+è´¨é‡ï¼‰ â†’ ä¼ä¸šç‰ˆï¼ˆ+æˆæœ¬ï¼‰
```

**3. é™ä½è€¦åˆ**

- åº”ç”¨é—´é€šè¿‡ API å’Œå¾®å‰ç«¯é€šä¿¡ï¼Œæ— ç›´æ¥ä»£ç ä¾èµ–
- å•ä¸ªåº”ç”¨å‡çº§ä¸å½±å“å…¶ä»–åº”ç”¨

**4. æé«˜æ•ˆç‡**

- ä¸åŒå›¢é˜Ÿå¹¶è¡Œå¼€å‘ä¸åŒåº”ç”¨
- å…±äº«ç»„ä»¶å’Œå·¥å…·åŒ…ç»Ÿä¸€ç»´æŠ¤

---

## 2. å¾®å‰ç«¯æ¶æ„

### 2.1 Module Federation è®¾è®¡

**æŠ€æœ¯é€‰å‹**ï¼š`@originjs/vite-plugin-federation` (åŸºäº Webpack 5 Module Federation)

**æ¶æ„ç¤ºæ„å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             é”€å”®åº”ç”¨ (saleApp)                              â”‚
â”‚           http://domain.com/main                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æš´éœ² (exposes):                                            â”‚
â”‚  Â· ./sale/demo/index.vue  â†’ è®¢å•åˆ—è¡¨é¡µ                      â”‚
â”‚  Â· ./sale/demo/form.vue   â†’ è®¢å•è¡¨å•é¡µ                      â”‚
â”‚  Â· ./sale/customer/index.vue â†’ å®¢æˆ·åˆ—è¡¨é¡µ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿œç¨‹åŠ è½½ (remotes):                                        â”‚
â”‚  Â· systemApp â†’ http://172.28.99.140/sub/systemApp/...      â”‚
â”‚  Â· agGridApp â†’ http://172.28.99.140/sub/ag-grid/...        â”‚
â”‚  Â· produceApp â†’ http://domain.com/produce/remoteEntry.js   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–²
                        â”‚ é€šè¿‡ remoteEntry.js åŠ¨æ€åŠ è½½
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å…¶ä»–åº”ç”¨ï¼ˆç”Ÿäº§/è´¨é‡/æˆæœ¬åº”ç”¨ï¼‰                      â”‚
â”‚  import('saleApp/sale/demo/index.vue')                     â”‚
â”‚  â†’ å¯ç›´æ¥åœ¨èœå•ä¸­é…ç½®è°ƒç”¨é”€å”®åº”ç”¨çš„è®¢å•åˆ—è¡¨é¡µ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ä½ç½®**ï¼š`vite/plugins/index.ts`

```typescript
import federation from "@originjs/vite-plugin-federation";

export default {
  plugins: [
    federation({
      name: "main_app", // å½“å‰åº”ç”¨åç§°
      filename: "remoteEntry.js", // å…¥å£æ–‡ä»¶å
      
      // 1. æš´éœ²ç»™å…¶ä»–åº”ç”¨çš„é¡µé¢
      exposes: {
        "./sale/demo/index.vue": "./src/views/sale/demo/index.vue",
        "./sale/demo/form.vue": "./src/views/sale/demo/form.vue",
        // æ‰€æœ‰æš´éœ²çš„é¡µé¢éœ€åœ¨ vite/plugins/shared/pages.ts ä¸­é…ç½®
      },
      
      // 2. è¿œç¨‹åŠ è½½çš„å­åº”ç”¨
      remotes: {
        systemApp: `http://172.28.99.140/sub/systemApp/assets/remoteEntry.js?t=${version}`,
        agGridApp: `http://172.28.99.140/sub/ag-grid/assets/remoteEntry.js?t=${version}`,
        produceApp: `http://domain.com/produce/assets/remoteEntry.js?t=${version}`
      },
      
      // 3. å…±äº«çš„ä¾èµ–ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
      shared: {
        vue: { singleton: true },
        pinia: { singleton: true },
        "vue-router": { singleton: true },
        "element-plus": { singleton: true },
        "@jhlc/common-core": { singleton: true },
        // ...æ›´å¤šå…±äº«ä¾èµ–
      }
    })
  ]
};
```

**é¡µé¢æš´éœ²é…ç½®**ï¼š`vite/plugins/shared/pages.ts`

```typescript
export const getPagesShared = function () {
  const ret = {};
  const list = [
    { name: "sale/demo/index.vue", label: "å†…è´¸è®¢å•" },
    { name: "sale/demo/form.vue", label: "è®¢å•ç»´æŠ¤" },
    { name: "sale/customer/index.vue", label: "å®¢æˆ·åˆ—è¡¨" },
    // æ–°å¢é¡µé¢åœ¨æ­¤é…ç½®
  ];
  
  list.forEach((item) => {
    ret["./" + item.name] = "./src/views/" + item.name;
  });
  
  return ret;
};
```

### 2.2 åº”ç”¨é—´é€šä¿¡

**1. è¿œç¨‹ç»„ä»¶åŠ è½½**

```typescript
// src/util/system.ts
export const fetchRemoteComponent = function(module: string, path: string): Promise<any> {
  return new Promise(async (resolve) => {
    const url = await getEntry(module); // è·å–è¿œç¨‹å…¥å£
    __federation_method_setRemote(module, { url, format: "esm", from: "vite" });
    const moduleWrapped = await __federation_method_getRemote(module, path);
    resolve(__federation_method_unwrapDefault(moduleWrapped));
  });
};
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```typescript
// åŠ è½½è¿œç¨‹å…¬å…±æ¨¡å—ï¼ˆrouterã€storeã€pluginsç­‰ï¼‰
const router = await fetchRemoteComponent("public", "./router/index.ts");
const store = await fetchRemoteComponent("public", "./store/index.ts");
const plugins = await fetchRemoteComponent("public", "./plugins/index.ts");

// ä½¿ç”¨è¿œç¨‹ç»„ä»¶
app.use(router);
app.use(store);
app.use(plugins);
```

**2. è·¨åº”ç”¨é¡µé¢è°ƒç”¨**

```typescript
// åœ¨ç³»ç»Ÿç®¡ç†ä¸­é…ç½®èœå•
{
  "menuName": "ç”Ÿäº§è®¡åˆ’",
  "path": "/produce/plan/list",
  "component": "produceApp/produce/plan/list/index.vue", // è·¨åº”ç”¨è°ƒç”¨
  "permissions": ["produce:plan:list"]
}
```

**3. äº‹ä»¶æ€»çº¿é€šä¿¡ï¼ˆå¯é€‰ï¼‰**

```typescript
// ä½¿ç”¨ PubSub æˆ– EventBus è¿›è¡Œè·¨åº”ç”¨é€šä¿¡
import PubSub from "pubsub-js";

// å‘å¸ƒäº‹ä»¶
PubSub.publish("order:updated", { orderId: "12345" });

// è®¢é˜…äº‹ä»¶
PubSub.subscribe("order:updated", (msg, data) => {
  console.log("è®¢å•æ›´æ–°:", data);
});
```

### 2.3 å…±äº«ä¾èµ–ç®¡ç†

**ä¾èµ–åˆ†ç±»**ï¼š

| ä¾èµ–ç±»å‹       | è¯´æ˜                     | ç¤ºä¾‹                                  | å…±äº«ç­–ç•¥     |
| -------------- | ------------------------ | ------------------------------------- | ------------ |
| **æ ¸å¿ƒæ¡†æ¶**   | æ¡†æ¶å’Œè·¯ç”±               | vue, vue-router, pinia                | singleton    |
| **UI ç»„ä»¶åº“**  | ç»„ä»¶åº“                   | element-plus, @element-plus/icons-vue | singleton    |
| **å…¬å…±å·¥å…·åŒ…** | å†…éƒ¨å·¥å…·åº“               | @jhlc/common-core, @jhlc/utils        | singleton    |
| **ç¬¬ä¸‰æ–¹åº“**   | å¸¸ç”¨ç¬¬ä¸‰æ–¹åº“             | lodash, moment, axios                 | æŒ‰éœ€å…±äº«     |
| **ä¸šåŠ¡ç»„ä»¶**   | ä¸šåŠ¡ç»„ä»¶åº“               | @jhlc/jh-ui                           | singleton    |

**å…±äº«é…ç½®åŸåˆ™**ï¼š

```typescript
shared: {
  // 1. æ ¸å¿ƒæ¡†æ¶ï¼ˆå¿…é¡» singletonï¼‰
  vue: { singleton: true, requiredVersion: "^3.2.25" },
  pinia: { singleton: true },
  "vue-router": { singleton: true },
  
  // 2. UI åº“ï¼ˆå¿…é¡» singletonï¼‰
  "element-plus": { singleton: true },
  
  // 3. å†…éƒ¨å…¬å…±åŒ…ï¼ˆå¿…é¡» singletonï¼‰
  "@jhlc/common-core": { singleton: true },
  "@jhlc/platform": { singleton: true },
  
  // 4. å·¥å…·åº“ï¼ˆæŒ‰éœ€å…±äº«ï¼‰
  lodash: {},
  moment: {},
  axios: { singleton: true },
  
  // 5. ä¸å…±äº«çš„ä¾èµ–ï¼ˆä¸»åº”ç”¨ç‹¬äº«ï¼‰
  // æŸäº›ç‰¹æ®Šä¾èµ–ä¸æ”¾å…¥ shared
}
```

**singleton è¯´æ˜**ï¼š

- âœ… **singleton: true**ï¼šç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ˆå¦‚ vueã€piniaï¼‰
- âŒ **ä¸è®¾ç½® singleton**ï¼šå…è®¸ä¸åŒç‰ˆæœ¬å…±å­˜ï¼ˆå¦‚ lodashï¼‰

---

## 3. é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰

### 3.1 é¢†åŸŸåˆ’åˆ†

**é¢†åŸŸæ‹†åˆ†åŸåˆ™**ï¼š

```
å¹³å° â†’ åº”ç”¨ â†’ é¢†åŸŸ â†’ å­ç³»ç»Ÿ â†’ æ¨¡å—
```

| å±‚çº§         | è¯´æ˜                 | ç¤ºä¾‹                                  | å¯¹åº”å…³ç³»       |
| ------------ | -------------------- | ------------------------------------- | -------------- |
| **å¹³å°**     | æ•´ä¸ªäº§å“åŒ–å¹³å°       | é‡‘æ’äº§å“åŒ–å¹³å°                        | å¤šä¸ªåº”ç”¨       |
| **åº”ç”¨**     | ç‹¬ç«‹çš„ Git ä»“åº“      | cx-ui-produceï¼ˆé”€å”®åº”ç”¨ï¼‰              | 1 ä¸ªé¢†åŸŸ       |
| **é¢†åŸŸ**     | ä¸šåŠ¡é¢†åŸŸ             | `sale/`ï¼ˆé”€å”®åŸŸï¼‰                     | å¤šä¸ªå­ç³»ç»Ÿ     |
| **å­ç³»ç»Ÿ**   | é¢†åŸŸä¸‹çš„ä¸šåŠ¡æ¨¡å—     | `order/`ï¼ˆè®¢å•ï¼‰ã€`customer/`ï¼ˆå®¢æˆ·ï¼‰ | å¤šä¸ªåŠŸèƒ½æ¨¡å—   |
| **æ¨¡å—**     | å­ç³»ç»Ÿä¸‹çš„åŠŸèƒ½æ¨¡å—   | `list/`ï¼ˆåˆ—è¡¨ï¼‰ã€`form/`ï¼ˆè¡¨å•ï¼‰      | å¤šä¸ªé¡µé¢       |

**å½“å‰é¡¹ç›®é¢†åŸŸ**ï¼š

```
cx-ui-produce (é”€å”®åº”ç”¨)
â””â”€â”€ sale/ (é”€å”®åŸŸ) - å”¯ä¸€é¢†åŸŸ
    â”œâ”€â”€ demo/ (æ¼”ç¤ºæ¨¡å— - è®¢å•ç®¡ç†)
    â”œâ”€â”€ customer/ (å®¢æˆ·ç®¡ç†)
    â”œâ”€â”€ contract/ (åˆåŒç®¡ç†)
    â””â”€â”€ analysis/ (é”€å”®åˆ†æ)
```

### 3.2 ç›®å½•ç»„ç»‡

**åœºæ™¯ä¸€ï¼šæ‰å¹³ç»“æ„ï¼ˆé€‚åˆç®€å•åº”ç”¨ï¼‰**

```
src/views/
â””â”€â”€ sale/                  # é”€å”®åŸŸ
    â”œâ”€â”€ order/             # å­ç³»ç»Ÿï¼šè®¢å•ç®¡ç†
    â”‚   â”œâ”€â”€ index.vue      # è®¢å•åˆ—è¡¨é¡µ
    â”‚   â”œâ”€â”€ form.vue       # è®¢å•è¡¨å•é¡µ
    â”‚   â””â”€â”€ detail.vue     # è®¢å•è¯¦æƒ…é¡µ
    â”‚
    â”œâ”€â”€ customer/          # å­ç³»ç»Ÿï¼šå®¢æˆ·ç®¡ç†
    â”‚   â”œâ”€â”€ index.vue      # å®¢æˆ·åˆ—è¡¨é¡µ
    â”‚   â”œâ”€â”€ form.vue       # å®¢æˆ·è¡¨å•é¡µ
    â”‚   â””â”€â”€ detail.vue     # å®¢æˆ·è¯¦æƒ…é¡µ
    â”‚
    â””â”€â”€ analysis/          # å­ç³»ç»Ÿï¼šé”€å”®åˆ†æ
        â”œâ”€â”€ dashboard.vue  # é”€å”®çœ‹æ¿
        â””â”€â”€ report.vue     # é”€å”®æŠ¥è¡¨
```

**åœºæ™¯äºŒï¼šå±‚çº§ç»“æ„ï¼ˆé€‚åˆå¤æ‚åº”ç”¨ï¼‰**

```
src/views/
â””â”€â”€ sale/                      # é”€å”®åŸŸ
    â”œâ”€â”€ order/                 # å­ç³»ç»Ÿï¼šè®¢å•ç®¡ç†
    â”‚   â”œâ”€â”€ domestic/          # æ¨¡å—ï¼šå†…è´¸è®¢å•
    â”‚   â”‚   â”œâ”€â”€ list/
    â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue  # åˆ—è¡¨é¡µ
    â”‚   â”‚   â”‚   â”œâ”€â”€ data.ts    # æ•°æ®é€»è¾‘
    â”‚   â”‚   â”‚   â””â”€â”€ index.scss # æ ·å¼
    â”‚   â”‚   â””â”€â”€ form/
    â”‚   â”‚       â””â”€â”€ index.vue  # è¡¨å•é¡µ
    â”‚   â”‚
    â”‚   â”œâ”€â”€ foreign/           # æ¨¡å—ï¼šå¤–è´¸è®¢å•
    â”‚   â”‚   â”œâ”€â”€ list/
    â”‚   â”‚   â””â”€â”€ form/
    â”‚   â”‚
    â”‚   â””â”€â”€ tracking/          # æ¨¡å—ï¼šè®¢å•è·Ÿè¸ª
    â”‚       â”œâ”€â”€ timeline.vue
    â”‚       â””â”€â”€ logistics.vue
    â”‚
    â”œâ”€â”€ customer/              # å­ç³»ç»Ÿï¼šå®¢æˆ·ç®¡ç†
    â”‚   â”œâ”€â”€ enterprise/        # æ¨¡å—ï¼šä¼ä¸šå®¢æˆ·
    â”‚   â”‚   â”œâ”€â”€ list/
    â”‚   â”‚   â””â”€â”€ detail/
    â”‚   â”‚
    â”‚   â””â”€â”€ individual/        # æ¨¡å—ï¼šä¸ªäººå®¢æˆ·
    â”‚       â”œâ”€â”€ list/
    â”‚       â””â”€â”€ detail/
    â”‚
    â””â”€â”€ analysis/              # å­ç³»ç»Ÿï¼šé”€å”®åˆ†æ
        â”œâ”€â”€ performance/       # æ¨¡å—ï¼šä¸šç»©åˆ†æ
        â”œâ”€â”€ forecast/          # æ¨¡å—ï¼šé”€å”®é¢„æµ‹
        â””â”€â”€ comparison/        # æ¨¡å—ï¼šå¯¹æ¯”åˆ†æ
```

**æ¨èç»“æ„ï¼ˆä¸‰æ–‡ä»¶åˆ†ç¦»ï¼‰**ï¼š

```
src/views/
â””â”€â”€ sale/
    â””â”€â”€ order/
        â””â”€â”€ list/              # åŠŸèƒ½æ¨¡å—
            â”œâ”€â”€ index.vue      # è§†å›¾å±‚ï¼ˆæ¨¡æ¿ï¼‰
            â”œâ”€â”€ data.ts        # æ•°æ®é€»è¾‘å±‚ï¼ˆå“åº”å¼æ•°æ®ã€APIè°ƒç”¨ï¼‰
            â”œâ”€â”€ index.scss     # æ ·å¼å±‚
            â””â”€â”€ components/    # é¡µé¢ç§æœ‰ç»„ä»¶
                â”œâ”€â”€ SearchForm.vue
                â””â”€â”€ BatchImport.vue
```

### 3.3 ä»£ç åˆ†å±‚

**åˆ†å±‚æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§†å›¾å±‚ (View)                       â”‚
â”‚                     index.vue                           â”‚
â”‚  èŒè´£: æ¨¡æ¿æ¸²æŸ“ã€äº‹ä»¶ç»‘å®šã€ç»„ä»¶ç»„åˆ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼ å¼•ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€»è¾‘å±‚ (Logic)                        â”‚
â”‚                      data.ts                            â”‚
â”‚  èŒè´£: å“åº”å¼æ•°æ®ã€ä¸šåŠ¡é€»è¾‘ã€APIè°ƒç”¨ã€çŠ¶æ€ç®¡ç†           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIå±‚ (API)                           â”‚
â”‚                   order-api.ts                          â”‚
â”‚  èŒè´£: HTTPè¯·æ±‚å°è£…ã€å‚æ•°å¤„ç†ã€å“åº”è½¬æ¢                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å·¥å…·å±‚ (Utils)                         â”‚
â”‚              @jhlc/common-core                          â”‚
â”‚  èŒè´£: é€šç”¨å·¥å…·å‡½æ•°ã€HTTPå®¢æˆ·ç«¯ã€è®¤è¯å·¥å…·                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†å±‚èŒè´£è¯´æ˜**ï¼š

| å±‚çº§       | æ–‡ä»¶                  | èŒè´£                                       | ç¦æ­¢æ“ä½œ                 |
| ---------- | --------------------- | ------------------------------------------ | ------------------------ |
| **è§†å›¾å±‚** | `index.vue`           | æ¨¡æ¿æ¸²æŸ“ã€äº‹ä»¶ç»‘å®šã€ç»„ä»¶ç»„åˆ               | ç›´æ¥è°ƒç”¨ APIã€å¤æ‚è®¡ç®—   |
| **é€»è¾‘å±‚** | `data.ts`             | å“åº”å¼æ•°æ®ã€ä¸šåŠ¡é€»è¾‘ã€API è°ƒç”¨             | ç›´æ¥æ“ä½œ DOM             |
| **API å±‚** | `order-api.ts`        | HTTP è¯·æ±‚å°è£…ã€å‚æ•°å¤„ç†                    | ä¸šåŠ¡é€»è¾‘å¤„ç†             |
| **å·¥å…·å±‚** | `@jhlc/common-core`   | é€šç”¨å·¥å…·å‡½æ•°ã€HTTP å®¢æˆ·ç«¯                  | ä¸šåŠ¡ç›¸å…³é€»è¾‘             |

**ä¼˜åŒ–æ–¹æ¡ˆï¼ˆé…ç½®åŒ–å¼€å‘ï¼‰**ï¼š

ä½¿ç”¨ `AbstractPageQueryHook` åŸºç±»ï¼Œ**æ— éœ€å•ç‹¬çš„ API å±‚**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§†å›¾å±‚ (View)                       â”‚
â”‚                     index.vue                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼ å¼•ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é€»è¾‘å±‚ (Logic + APIé…ç½®)                 â”‚
â”‚                      data.ts                            â”‚
â”‚  Â· API_CONFIG é…ç½®ï¼ˆæ›¿ä»£APIå±‚ï¼‰                          â”‚
â”‚  Â· ç»§æ‰¿ AbstractPageQueryHook åŸºç±»                      â”‚
â”‚  Â· ç›´æ¥ä½¿ç”¨ this.getAction / postAction ç­‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼ ç»§æ‰¿
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AbstractPageQueryHook åŸºç±»                 â”‚
â”‚              @jhlc/common-core                          â”‚
â”‚  Â· getAction / postAction / putAction / deleteAction    â”‚
â”‚  Â· actionBatch / postBatch / putBatch / deleteBatch     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯¦è§**ï¼š[9. API å±‚æ¶æ„è®¾è®¡](#9-api-å±‚æ¶æ„è®¾è®¡)

---

## 4. æŠ€æœ¯æ ˆæ¶æ„

### 4.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯               | ç‰ˆæœ¬       | ç”¨é€”               | å¤‡æ³¨                   |
| ------------------ | ---------- | ------------------ | ---------------------- |
| **Vue**            | 3.2.25     | å‰ç«¯æ¡†æ¶           | Composition API        |
| **Vite**           | 4.x        | æ„å»ºå·¥å…·           | å¿«é€Ÿå¼€å‘ã€HMR          |
| **TypeScript**     | 5.x        | ç±»å‹ç³»ç»Ÿ           | ç±»å‹å®‰å…¨               |
| **Pinia**          | 2.0.14     | çŠ¶æ€ç®¡ç†           | æ›¿ä»£ Vuex              |
| **Vue Router**     | 4.4.3      | è·¯ç”±ç®¡ç†           | åŠ¨æ€è·¯ç”±ã€æƒé™æ§åˆ¶     |
| **Element Plus**   | 2.2.6      | UI ç»„ä»¶åº“          | ä¼ä¸šçº§ç»„ä»¶             |
| **WindiCSS**       | 3.5.6      | åŸå­åŒ– CSS         | æŒ‰éœ€ç”Ÿæˆã€æ€§èƒ½ä¼˜åŒ–     |
| **Axios**          | 0.27.2     | HTTP å®¢æˆ·ç«¯        | è¯·æ±‚æ‹¦æˆªã€å“åº”å¤„ç†     |

**å¾®å‰ç«¯ç›¸å…³**ï¼š

| æŠ€æœ¯                                      | ç”¨é€”                   | è¯´æ˜                           |
| ----------------------------------------- | ---------------------- | ------------------------------ |
| **@originjs/vite-plugin-federation**      | Module Federation æ’ä»¶ | Vite ç‰ˆ Module Federation      |
| **@jhlc/platform**                        | å¹³å°æ ¸å¿ƒåŒ…             | å¹³å°åˆå§‹åŒ–ã€è·¯ç”±ç”Ÿæˆã€æƒé™æ§åˆ¶ |
| **@jhlc/common-core**                     | å…¬å…±å·¥å…·åŒ…             | HTTP å·¥å…·ã€è®¤è¯ã€å·¥å…·å‡½æ•°      |

### 4.2 å·¥ç¨‹åŒ–å·¥å…·

| å·¥å…·                           | ç”¨é€”               | é…ç½®æ–‡ä»¶                      |
| ------------------------------ | ------------------ | ----------------------------- |
| **Husky**                      | Git Hooks          | `.husky/`                     |
| **Commitlint**                 | æäº¤ä¿¡æ¯è§„èŒƒ       | `commitlint.config.cjs`       |
| **ESLint**                     | ä»£ç è§„èŒƒæ£€æŸ¥       | `.eslintrc.js`                |
| **Prettier**                   | ä»£ç æ ¼å¼åŒ–         | `.prettierrc`                 |
| **TypeScript**                 | ç±»å‹æ£€æŸ¥           | `tsconfig.json`               |
| **unplugin-vue-components**    | ç»„ä»¶è‡ªåŠ¨å¯¼å…¥       | `vite/plugins/auto-import.js` |
| **unplugin-auto-import**       | API è‡ªåŠ¨å¯¼å…¥       | `vite/plugins/auto-import.js` |

### 4.3 ä¾èµ–ç®¡ç†

**åŒ…ç®¡ç†å™¨**ï¼š`pnpm` (æ¨è)

**ä¾èµ–åˆ†ç±»**ï¼š

```json
{
  "dependencies": {
    // 1. æ ¸å¿ƒæ¡†æ¶
    "vue": "~3.2.25",
    "pinia": "~2.0.14",
    "vue-router": "4.4.3",
    
    // 2. UI ç»„ä»¶åº“
    "element-plus": "2.2.6-prod.3",
    "@element-plus/icons-vue": "2.1.0",
    
    // 3. å†…éƒ¨å…¬å…±åŒ…ï¼ˆ@jhlcï¼‰
    "@jhlc/common-core": "^3.1.0",
    "@jhlc/platform": "^3.1.0",
    "@jhlc/jh-ui": "3.1.0",
    "@jhlc/utils": "3.1.0",
    "@jhlc/types": "3.1.0",
    
    // 4. å·¥å…·åº“
    "axios": "^0.27.2",
    "lodash": "^4.17.21",
    "moment": "^2.30.1",
    "qs": "^6.10.3",
    
    // 5. ä¸šåŠ¡ç›¸å…³
    "echarts": "5.3.2",
    "xlsx": "^0.18.5",
    "file-saver": "2.0.5"
  },
  "devDependencies": {
    // æ„å»ºå·¥å…·
    "@vitejs/plugin-vue": "latest",
    "vite": "latest",
    
    // å¾®å‰ç«¯
    "@originjs/vite-plugin-federation": "latest",
    
    // å·¥ç¨‹åŒ–
    "husky": "latest",
    "@commitlint/cli": "latest",
    "typescript": "latest"
  }
}
```

**å†…ç½‘ç§æœ‰æºé…ç½®**ï¼š`.npmrc`

```ini
# @jhlc åŒ…ä»å†…ç½‘ä¸‹è½½
registry=http://172.18.248.130/
@jhlc:registry=http://172.18.248.130/
```

---

## 5. è·¯ç”±ä¸æƒé™æ¶æ„

### 5.1 åŠ¨æ€è·¯ç”±ç”Ÿæˆ

**æ¶æ„æµç¨‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç™»å½•   â”‚ â”€â”€â”€> â”‚ è·å–èœå•   â”‚ â”€â”€â”€> â”‚ ç”Ÿæˆè·¯ç”±   â”‚
â”‚            â”‚      â”‚ (API)      â”‚      â”‚ (å‰ç«¯)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ åŠ¨æ€æ³¨å†Œåˆ° Vue Router            â”‚
                    â”‚ router.addRoute(route)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä½ç½®**ï¼š`src/permission.ts`

```typescript
import { fetchRemoteComponent } from "@/util/system";
import { getToken } from "@jhlc/common-core/src/util/auth";
import user from "@jhlc/common-core/src/store/user";

const router = await fetchRemoteComponent("public", "./router/index.ts");
const usePermissionStore = await fetchRemoteComponent(
  "public",
  "./store/modules/permission.ts"
);

router.beforeEach(async (to, from, next) => {
  const permissionStore = usePermissionStore();
  const userStore = user();
  
  // 1. Token éªŒè¯
  if (getToken()) {
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯
    if (!fetchUserFlag) {
      fetchUserFlag = true;
      await userStore.getUserInfo();
    }
    
    // 3. ç”Ÿæˆè·¯ç”±
    if (!permissionStore.generated) {
      permissionStore.generated = true;
      
      // ä¼˜å…ˆæ³¨å†Œå½“å‰èœå•ï¼Œå¼‚æ­¥æ³¨å†Œå…¶ä»–å­ç³»ç»Ÿ
      await permissionStore.generateCurrentRoute(to);
      permissionStore.generateRoutes(to);
      permissionStore.isRouterGenerated = true;
      
      return next({ ...to, replace: true });
    }
    else {
      return next();
    }
  }
  else {
    // ç™½åå•è·¯ç”±ç›´æ¥æ”¾è¡Œ
    if (whiteList.indexOf(to.path) !== -1) {
      next();
    } else {
      next(`/login?redirect=${to.fullPath}`);
    }
  }
});
```

**è·¯ç”±é…ç½®ç¤ºä¾‹**ï¼š

```typescript
// åç«¯è¿”å›çš„èœå•æ•°æ®
{
  "menuId": "1001",
  "menuName": "è®¢å•ç®¡ç†",
  "path": "/sale/order/list",
  "component": "saleApp/sale/order/list/index.vue", // å¾®å‰ç«¯è·¯å¾„
  "permissions": ["sale:order:list"]
}

// å‰ç«¯ç”Ÿæˆçš„è·¯ç”±
{
  path: "/sale/order/list",
  name: "SaleOrderList",
  component: () => import("saleApp/sale/order/list/index.vue"), // åŠ¨æ€ import
  meta: {
    title: "è®¢å•ç®¡ç†",
    permissions: ["sale:order:list"]
  }
}
```

### 5.2 æƒé™æ§åˆ¶

**1. è·¯ç”±æƒé™**

```typescript
// è·¯ç”±å®ˆå«ä¸­æ£€æŸ¥æƒé™
router.beforeEach((to, from, next) => {
  const userStore = user();
  const permissions = to.meta.permissions;
  
  if (permissions && !userStore.hasPermission(permissions)) {
    // æ— æƒé™ï¼Œè·³è½¬åˆ° 403 é¡µé¢
    next("/403");
  } else {
    next();
  }
});
```

**2. æŒ‰é’®æƒé™æŒ‡ä»¤**

```vue
<template>
  <!-- ä½¿ç”¨ v-permission æŒ‡ä»¤ -->
  <el-button v-permission="['sale:order:add']" @click="handleAdd">
    æ–°å¢
  </el-button>
  
  <!-- æˆ–ä½¿ç”¨ v-if åˆ¤æ–­ -->
  <el-button v-if="hasPermission('sale:order:edit')" @click="handleEdit">
    ç¼–è¾‘
  </el-button>
</template>

<script setup lang="ts">
import { hasPermission } from "@jhlc/common-core/src/util/permission";
</script>
```

**3. æ•°æ®æƒé™**

```typescript
// API è°ƒç”¨æ—¶è‡ªåŠ¨å¸¦ä¸Šæ•°æ®æƒé™å‚æ•°
const res = await getOrderList({
  page: 1,
  pageSize: 20,
  // åç«¯æ ¹æ®ç”¨æˆ·æƒé™è‡ªåŠ¨è¿‡æ»¤æ•°æ®
});
```

### 5.3 èœå•é…ç½®

**ç³»ç»Ÿç®¡ç†ä¸­é…ç½®èœå•**ï¼š

| å­—æ®µ         | è¯´æ˜                           | ç¤ºä¾‹                                    |
| ------------ | ------------------------------ | --------------------------------------- |
| **èœå•åç§°** | æ˜¾ç¤ºåœ¨ä¾§è¾¹æ çš„åç§°             | è®¢å•ç®¡ç†                                |
| **è·¯ç”±åœ°å€** | å‰ç«¯è·¯ç”±è·¯å¾„                   | `/sale/order/list`                      |
| **ç»„ä»¶è·¯å¾„** | å¾®å‰ç«¯ç»„ä»¶è·¯å¾„ï¼ˆå…³é”®ï¼‰         | `saleApp/sale/order/list/index.vue`     |
| **æƒé™æ ‡è¯†** | æƒé™æ§åˆ¶æ ‡è¯†                   | `sale:order:list`                       |
| **èœå•ç±»å‹** | ç›®å½•ã€èœå•ã€æŒ‰é’®               | èœå•                                    |
| **æ’åº**     | èœå•é¡ºåº                       | 1                                       |
| **å›¾æ ‡**     | èœå•å›¾æ ‡                       | `el-icon-document`                      |

**ç»„ä»¶è·¯å¾„è§„èŒƒ**ï¼š

```
{åº”ç”¨å}/{é¢†åŸŸ}/{å­ç³»ç»Ÿ}/{æ¨¡å—}/{é¡µé¢}.vue

ç¤ºä¾‹ï¼š
saleApp/sale/order/list/index.vue
saleApp/sale/customer/form/index.vue
produceApp/produce/plan/list/index.vue
```

**æ³¨æ„**ï¼š

- åº”ç”¨åå¿…é¡»ä¸ Module Federation é…ç½®çš„ `name` ä¸€è‡´
- é¡µé¢å¿…é¡»åœ¨ `vite/plugins/shared/pages.ts` ä¸­é…ç½®æš´éœ²

---

## 6. çŠ¶æ€ç®¡ç†æ¶æ„

### 6.1 Pinia Store è®¾è®¡

**Store åˆ†ç±»**ï¼š

```
stores/
â”œâ”€â”€ user.ts           # ç”¨æˆ· Storeï¼ˆç”¨æˆ·ä¿¡æ¯ã€Tokenã€æƒé™ï¼‰
â”œâ”€â”€ permission.ts     # æƒé™ Storeï¼ˆèœå•ã€è·¯ç”±ã€æƒé™ï¼‰
â”œâ”€â”€ app.ts            # åº”ç”¨ Storeï¼ˆå…¨å±€çŠ¶æ€ã€ä¸»é¢˜ã€è¯­è¨€ï¼‰
â”œâ”€â”€ settings.ts       # è®¾ç½® Storeï¼ˆä¾§è¾¹æ ã€æ ‡ç­¾é¡µã€å¸ƒå±€ï¼‰
â””â”€â”€ modules/
    â”œâ”€â”€ order.ts      # è®¢å• Storeï¼ˆä¸šåŠ¡çŠ¶æ€ï¼‰
    â””â”€â”€ customer.ts   # å®¢æˆ· Storeï¼ˆä¸šåŠ¡çŠ¶æ€ï¼‰
```

**Store å®šä¹‰è§„èŒƒ**ï¼š

```typescript
// src/stores/modules/order.ts
import { defineStore } from "pinia";
import { ref, computed } from "vue";
import { getOrderList } from "@/api/order";

export const useOrderStore = defineStore(
  "order", // Store ID
  () => {
    // ==================== 1. çŠ¶æ€å®šä¹‰ ====================
    const orderList = ref([]);
    const currentOrder = ref(null);
    const loading = ref(false);
    
    // ==================== 2. è®¡ç®—å±æ€§ ====================
    const totalAmount = computed(() => {
      return orderList.value.reduce((sum, item) => sum + item.amount, 0);
    });
    
    // ==================== 3. æ–¹æ³•å®šä¹‰ ====================
    const fetchOrderList = async (params: any) => {
      loading.value = true;
      try {
        const res = await getOrderList(params);
        orderList.value = res.data.records;
      } finally {
        loading.value = false;
      }
    };
    
    const setCurrentOrder = (order: any) => {
      currentOrder.value = order;
    };
    
    const resetStore = () => {
      orderList.value = [];
      currentOrder.value = null;
      loading.value = false;
    };
    
    // ==================== 4. è¿”å›ï¼ˆæš´éœ²ï¼‰ ====================
    return {
      // çŠ¶æ€
      orderList,
      currentOrder,
      loading,
      
      // è®¡ç®—å±æ€§
      totalAmount,
      
      // æ–¹æ³•
      fetchOrderList,
      setCurrentOrder,
      resetStore
    };
  },
  {
    // ==================== 5. æŒä¹…åŒ–é…ç½® ====================
    persist: {
      key: "order-store",
      storage: localStorage,
      paths: ["currentOrder"] // åªæŒä¹…åŒ–éƒ¨åˆ†çŠ¶æ€
    }
  }
);
```

### 6.2 çŠ¶æ€æŒä¹…åŒ–

**ä½¿ç”¨æ’ä»¶**ï¼š`pinia-plugin-persistedstate`

**é…ç½®ä½ç½®**ï¼šStore å®šä¹‰æ—¶é…ç½®

```typescript
import { defineStore } from "pinia";

export const useUserStore = defineStore(
  "user",
  () => {
    const token = ref("");
    const userInfo = ref({});
    
    return { token, userInfo };
  },
  {
    persist: {
      key: "user-store",        // localStorage çš„ key
      storage: localStorage,     // å­˜å‚¨æ–¹å¼ï¼ˆlocalStorage/sessionStorageï¼‰
      paths: ["token", "userInfo"] // æŒä¹…åŒ–å­—æ®µï¼ˆå¯é€‰ï¼Œé»˜è®¤å…¨éƒ¨ï¼‰
    }
  }
);
```

**æŒä¹…åŒ–ç­–ç•¥**ï¼š

| Store            | æŒä¹…åŒ–   | å­˜å‚¨æ–¹å¼        | æŒä¹…åŒ–å­—æ®µ               | è¯´æ˜               |
| ---------------- | -------- | --------------- | ------------------------ | ------------------ |
| **user**         | âœ…       | localStorage    | token, userInfo          | ç”¨æˆ·ç™»å½•æ€å¿…é¡»æŒä¹…åŒ– |
| **permission**   | âœ…       | sessionStorage  | routes, menus            | åˆ·æ–°é¡µé¢éœ€é‡æ–°è·å– |
| **app**          | âœ…       | localStorage    | theme, language, sidebar | ç”¨æˆ·åå¥½è®¾ç½®       |
| **order**        | âŒ       | -               | -                        | ä¸šåŠ¡çŠ¶æ€æ— éœ€æŒä¹…åŒ– |

### 6.3 Store æœ€ä½³å®è·µ

**1. ä½¿ç”¨ Composition API é£æ ¼**

```typescript
// âœ… æ¨èï¼šComposition API é£æ ¼ï¼ˆæ›´çµæ´»ï¼‰
export const useUserStore = defineStore("user", () => {
  const token = ref("");
  const setToken = (newToken: string) => {
    token.value = newToken;
  };
  
  return { token, setToken };
});

// âŒ ä¸æ¨èï¼šOptions API é£æ ¼
export const useUserStore = defineStore("user", {
  state: () => ({ token: "" }),
  actions: {
    setToken(newToken) {
      this.token = newToken;
    }
  }
});
```

**2. Store èŒè´£åˆ†ç¦»**

```typescript
// âœ… æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ† Store
useOrderStore()   // è®¢å•ç›¸å…³çŠ¶æ€
useCustomerStore() // å®¢æˆ·ç›¸å…³çŠ¶æ€

// âŒ ä¸€ä¸ª Store åŒ…å«æ‰€æœ‰ä¸šåŠ¡çŠ¶æ€
useBusinessStore() // æ··æ‚äº†è®¢å•ã€å®¢æˆ·ã€åˆåŒç­‰
```

**3. é¿å…çŠ¶æ€å†—ä½™**

```typescript
// âœ… ä½¿ç”¨è®¡ç®—å±æ€§æ´¾ç”ŸçŠ¶æ€
const totalAmount = computed(() => {
  return orderList.value.reduce((sum, item) => sum + item.amount, 0);
});

// âŒ ç»´æŠ¤å†—ä½™çŠ¶æ€
const totalAmount = ref(0);
watch(orderList, () => {
  totalAmount.value = orderList.value.reduce((sum, item) => sum + item.amount, 0);
});
```

**4. ç»„ä»¶ä¸­ä½¿ç”¨ Store**

```vue
<script setup lang="ts">
import { useUserStore } from "@/stores/user";
import { storeToRefs } from "pinia";

const userStore = useUserStore();

// âœ… ä½¿ç”¨ storeToRefs ä¿æŒå“åº”å¼
const { token, userInfo } = storeToRefs(userStore);

// âœ… æ–¹æ³•ç›´æ¥è§£æ„ï¼ˆæ–¹æ³•ä¸éœ€è¦ä¿æŒå“åº”å¼ï¼‰
const { setToken, logout } = userStore;
</script>
```

---

## 7. ç»„ä»¶è®¾è®¡æ¶æ„

### 7.1 ç»„ä»¶åˆ†ç±»ä¸å‘½å

| ç»„ä»¶ç±»å‹       | å‰ç¼€   | å‘½åæ–¹å¼     | ç¤ºä¾‹                                    | å­˜æ”¾ä½ç½®                           |
| -------------- | ------ | ------------ | --------------------------------------- | ---------------------------------- |
| **å…¨å±€å…¬å…±ç»„ä»¶** | `C_`   | C_PascalCase | `C_Table`ã€`C_Dialog`ã€`C_Form`         | `src/components/global/`           |
| **ä¸šåŠ¡åŸŸç»„ä»¶**   | `c_`   | c_pascalCase | `c_orderTable`ã€`c_customerForm`        | `src/views/{domain}/components/`   |
| **é¡µé¢ç§æœ‰ç»„ä»¶** | æ— å‰ç¼€ | PascalCase   | `SearchForm`ã€`OrderItems`              | `src/views/{domain}/{module}/components/` |

**å‘½åå¯¹æ¯”è¡¨**ï¼š

| ç»„ä»¶ç±»å‹     | ç¤ºä¾‹                          | é¦–å­—æ¯            | è¯†åˆ«ç‰¹å¾   | ä½¿ç”¨èŒƒå›´     |
| ------------ | ----------------------------- | ----------------- | ---------- | ------------ |
| å…¨å±€ç»„ä»¶     | `C_Table`ã€`C_Dialog`         | å¤§å†™ C + å¤§å†™å¼€å¤´ | å…¨å¹³å°é€šç”¨ | æ‰€æœ‰åº”ç”¨     |
| ä¸šåŠ¡åŸŸç»„ä»¶   | `c_orderTable`ã€`c_saleChart` | å°å†™ c + **å°å†™å¼€å¤´** | é¢†åŸŸå†…å…±äº« | å½“å‰é¢†åŸŸ     |
| é¡µé¢ç§æœ‰ç»„ä»¶ | `SearchForm`ã€`OrderItems`    | æ— å‰ç¼€ + å¤§å†™å¼€å¤´ | é¡µé¢ä¸“å±   | å½“å‰é¡µé¢     |

**ç›®å½•ç»“æ„**ï¼š

```
src/
â”œâ”€â”€ components/                    # å…¨å±€å…¬å…±ç»„ä»¶ï¼ˆC_å‰ç¼€ï¼‰
â”‚   â”œâ”€â”€ global/
â”‚   â”‚   â”œâ”€â”€ C_Table/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ data.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.scss
â”‚   â”‚   â”œâ”€â”€ C_Dialog/
â”‚   â”‚   â””â”€â”€ C_Form/
â”‚   â””â”€â”€ local/                     # å±€éƒ¨å…¨å±€ç»„ä»¶ï¼ˆæ— å‰ç¼€ï¼‰
â”‚       â”œâ”€â”€ c_actionModal/
â”‚       â””â”€â”€ c_formModal/
â”‚
â””â”€â”€ views/
    â””â”€â”€ sale/                      # é”€å”®åŸŸ
        â”œâ”€â”€ components/            # ä¸šåŠ¡åŸŸç»„ä»¶ï¼ˆc_pascalCaseï¼‰
        â”‚   â”œâ”€â”€ c_orderTable/
        â”‚   â”‚   â”œâ”€â”€ index.vue
        â”‚   â”‚   â”œâ”€â”€ data.ts
        â”‚   â”‚   â””â”€â”€ index.scss
        â”‚   â”œâ”€â”€ c_customerForm/
        â”‚   â””â”€â”€ c_saleChart/
        â”‚
        â””â”€â”€ order/
            â””â”€â”€ list/              # é¡µé¢åŠŸèƒ½
                â”œâ”€â”€ index.vue
                â”œâ”€â”€ data.ts
                â”œâ”€â”€ index.scss
                â””â”€â”€ components/    # é¡µé¢ç§æœ‰ç»„ä»¶ï¼ˆæ— å‰ç¼€ï¼‰
                    â”œâ”€â”€ SearchForm/
                    â””â”€â”€ BatchImport/
```

### 7.2 ç»„ä»¶èŒè´£åˆ’åˆ†

**1. å…¨å±€å…¬å…±ç»„ä»¶ï¼ˆC_å‰ç¼€ï¼‰**

**èŒè´£**ï¼šæä¾›é€šç”¨çš„ã€å¹³å°çº§çš„ç»„ä»¶èƒ½åŠ›

**ç‰¹å¾**ï¼š

- âœ… æ— ä¸šåŠ¡é€»è¾‘ï¼Œçº¯å±•ç¤ºæˆ–äº¤äº’
- âœ… é«˜åº¦å¯é…ç½®ï¼ˆé€šè¿‡ Propsï¼‰
- âœ… å¯åœ¨æ‰€æœ‰åº”ç”¨ä¸­ä½¿ç”¨
- âœ… é€šè¿‡ `unplugin-vue-components` è‡ªåŠ¨å¯¼å…¥

**ç¤ºä¾‹**ï¼š

```vue
<!-- C_Table.vue - å…¨å±€è¡¨æ ¼ç»„ä»¶ -->
<template>
  <el-table :data="data" v-bind="$attrs">
    <slot />
  </el-table>
</template>

<script setup lang="ts">
defineOptions({ name: "CTable" });

defineProps<{
  data: any[];
}>();
</script>
```

**ä½¿ç”¨**ï¼š

```vue
<template>
  <!-- æ— éœ€å¯¼å…¥ï¼Œè‡ªåŠ¨è¯†åˆ« -->
  <C_Table :data="tableData">
    <el-table-column prop="name" label="å§“å" />
  </C_Table>
</template>
```

**2. ä¸šåŠ¡åŸŸç»„ä»¶ï¼ˆc_å‰ç¼€ï¼‰**

**èŒè´£**ï¼šæä¾›é¢†åŸŸå†…å…±äº«çš„ä¸šåŠ¡ç»„ä»¶

**ç‰¹å¾**ï¼š

- âœ… åŒ…å«ä¸šåŠ¡é€»è¾‘
- âœ… é¢†åŸŸå†…å¤ç”¨ï¼ˆå¦‚è®¢å•è¡¨æ ¼ã€å®¢æˆ·è¡¨å•ï¼‰
- âœ… ä¸è·¨é¢†åŸŸä½¿ç”¨
- âœ… å‘½åä»¥ `c_` å¼€å¤´ï¼Œé¦–å­—æ¯å°å†™

**ç¤ºä¾‹**ï¼š

```vue
<!-- c_orderTable.vue - è®¢å•è¡¨æ ¼ç»„ä»¶ -->
<template>
  <C_Table :data="data">
    <el-table-column prop="orderNo" label="è®¢å•å·" />
    <el-table-column prop="customerName" label="å®¢æˆ·åç§°" />
    <el-table-column label="æ“ä½œ">
      <template #default="{ row }">
        <el-button @click="handleView(row)">æŸ¥çœ‹</el-button>
        <el-button @click="handleEdit(row)">ç¼–è¾‘</el-button>
      </template>
    </el-table-column>
  </C_Table>
</template>

<script setup lang="ts">
defineOptions({ name: "OrderTable" });

defineProps<{
  data: any[];
}>();

const emit = defineEmits<{
  (e: "view", row: any): void;
  (e: "edit", row: any): void;
}>();

const handleView = (row: any) => emit("view", row);
const handleEdit = (row: any) => emit("edit", row);
</script>
```

**ä½¿ç”¨**ï¼š

```vue
<template>
  <c_orderTable :data="tableData" @view="handleView" @edit="handleEdit" />
</template>

<script setup lang="ts">
import c_orderTable from "@/views/sale/components/c_orderTable";
</script>
```

**3. é¡µé¢ç§æœ‰ç»„ä»¶ï¼ˆæ— å‰ç¼€ï¼‰**

**èŒè´£**ï¼šä»…åœ¨å½“å‰é¡µé¢ä½¿ç”¨çš„ç»„ä»¶

**ç‰¹å¾**ï¼š

- âœ… ç´§å¯†è€¦åˆé¡µé¢é€»è¾‘
- âœ… ä¸è¢«å…¶ä»–é¡µé¢å¤ç”¨
- âœ… æ— å‰ç¼€ï¼ŒPascalCase å‘½å

**ç¤ºä¾‹**ï¼š

```vue
<!-- SearchForm.vue - è®¢å•åˆ—è¡¨æœç´¢è¡¨å• -->
<template>
  <el-form :model="form" inline>
    <el-form-item label="è®¢å•å·">
      <el-input v-model="form.orderNo" />
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="handleSearch">æœç´¢</el-button>
    </el-form-item>
  </el-form>
</template>

<script setup lang="ts">
defineOptions({ name: "OrderSearchForm" });

const form = reactive({
  orderNo: "",
  customerName: ""
});

const emit = defineEmits<{
  (e: "search", form: any): void;
}>();

const handleSearch = () => emit("search", form);
</script>
```

### 7.3 ç»„ä»¶é€šä¿¡æ¨¡å¼

**1. Props / Emitsï¼ˆçˆ¶å­é€šä¿¡ï¼‰**

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <OrderForm :data="formData" @submit="handleSubmit" />
</template>

<script setup lang="ts">
const formData = ref({});
const handleSubmit = (data: any) => {
  console.log("æäº¤æ•°æ®:", data);
};
</script>

<!-- å­ç»„ä»¶ -->
<template>
  <el-form :model="data">
    <el-button @click="handleSubmit">æäº¤</el-button>
  </el-form>
</template>

<script setup lang="ts">
const props = defineProps<{ data: any }>();
const emit = defineEmits<{ (e: "submit", data: any): void }>();

const handleSubmit = () => emit("submit", props.data);
</script>
```

**2. Provide / Injectï¼ˆè·¨å±‚çº§é€šä¿¡ï¼‰**

```vue
<!-- ç¥–å…ˆç»„ä»¶ -->
<script setup lang="ts">
import { provide } from "vue";
provide("orderContext", { orderId: "12345" });
</script>

<!-- åä»£ç»„ä»¶ -->
<script setup lang="ts">
import { inject } from "vue";
const orderContext = inject("orderContext");
</script>
```

**3. Pinia Storeï¼ˆå…¨å±€çŠ¶æ€ï¼‰**

```vue
<script setup lang="ts">
import { useOrderStore } from "@/stores/modules/order";
const orderStore = useOrderStore();

// è¯»å–çŠ¶æ€
console.log(orderStore.orderList);

// ä¿®æ”¹çŠ¶æ€
orderStore.setCurrentOrder(order);
</script>
```

**4. EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼Œæ…ç”¨ï¼‰**

```typescript
// eventBus.ts
import mitt from "mitt";
export const eventBus = mitt();

// ç»„ä»¶ A
eventBus.emit("order:updated", { orderId: "12345" });

// ç»„ä»¶ B
eventBus.on("order:updated", (data) => {
  console.log("è®¢å•æ›´æ–°:", data);
});
```

---

## 8. ä»£ç ç»„ç»‡è§„èŒƒ

### 8.1 æ–‡ä»¶å‘½åè§„èŒƒ

| ç±»å‹         | å‘½åæ–¹å¼         | ç¤ºä¾‹                  | è¯´æ˜                      |
| ------------ | ---------------- | --------------------- | ------------------------- |
| **é¡µé¢ç»„ä»¶** | `index.vue`      | `index.vue`           | ç»Ÿä¸€ä½¿ç”¨ index ä½œä¸ºä¸»å…¥å£ |
| **æ•°æ®é€»è¾‘** | `data.ts`        | `data.ts`             | å­˜æ”¾æ•°æ®å®šä¹‰ã€æ¥å£è°ƒç”¨    |
| **æ ·å¼æ–‡ä»¶** | `index.scss`     | `index.scss`          | é¡µé¢ä¸“å±æ ·å¼              |
| **å­ç»„ä»¶**   | `PascalCase.vue` | `OrderForm.vue`       | å¤§é©¼å³°å‘½å                |
| **å¼¹çª—ç»„ä»¶** | `modal.vue`      | `modal.vue`           | ç»Ÿä¸€å‘½åä¸º modal          |
| **API æ–‡ä»¶** | `kebab-case.ts`  | `order-api.ts`        | å°å†™+è¿å­—ç¬¦               |
| **å·¥å…·æ–‡ä»¶** | `kebab-case.ts`  | `format-util.ts`      | å°å†™+è¿å­—ç¬¦               |
| **ç±»å‹æ–‡ä»¶** | `kebab-case.ts`  | `order-types.ts`      | å°å†™+è¿å­—ç¬¦               |

### 8.2 ä¸‰æ–‡ä»¶åˆ†ç¦»æ¨¡å¼

**ä¸ºä»€ä¹ˆè¦åˆ†ç¦»æ–‡ä»¶ï¼Ÿ**

1. **èŒè´£åˆ†ç¦»**ï¼šè§†å›¾(Vue)ã€é€»è¾‘(TS)ã€æ ·å¼(SCSS)å„å¸å…¶èŒ
2. **å¯ç»´æŠ¤æ€§**ï¼šå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 300 è¡Œï¼Œä¾¿äºç»´æŠ¤
3. **å¯å¤ç”¨æ€§**ï¼šæ•°æ®é€»è¾‘å¯ä»¥è¢«å¤šä¸ªç»„ä»¶å¤ç”¨
4. **å›¢é˜Ÿåä½œ**ï¼šä¸åŒæˆå‘˜å¯ä»¥åŒæ—¶ç¼–è¾‘ä¸åŒæ–‡ä»¶

**æ ‡å‡†ç›®å½•ç»“æ„**ï¼š

```
src/views/
â””â”€â”€ sale/
    â””â”€â”€ order/
        â””â”€â”€ list/              # åŠŸèƒ½æ¨¡å—
            â”œâ”€â”€ index.vue      # è§†å›¾å±‚ï¼ˆæ¨¡æ¿ï¼‰
            â”œâ”€â”€ data.ts        # æ•°æ®é€»è¾‘å±‚ï¼ˆå“åº”å¼æ•°æ®ã€APIè°ƒç”¨ï¼‰
            â”œâ”€â”€ index.scss     # æ ·å¼å±‚
            â””â”€â”€ components/    # é¡µé¢ç§æœ‰ç»„ä»¶
                â”œâ”€â”€ SearchForm.vue
                â””â”€â”€ BatchImport.vue
```

**index.vue - è§†å›¾å±‚**

```vue
<template>
  <div class="order-list-page">
    <el-card>
      <el-form :model="searchForm" inline>
        <el-form-item label="è®¢å•å·">
          <el-input v-model="searchForm.orderNo" />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">æœç´¢</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <el-card>
      <el-table v-loading="loading" :data="tableData">
        <el-table-column prop="orderNo" label="è®¢å•å·" />
        <el-table-column prop="customerName" label="å®¢æˆ·åç§°" />
      </el-table>

      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.pageSize"
        :total="pagination.total"
        @current-change="handleSearch"
      />
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { onMounted } from "vue";
import {
  searchForm,
  tableData,
  pagination,
  loading,
  fetchList,
  handleSearch
} from "./data";

onMounted(() => {
  fetchList();
});
</script>

<style lang="scss" scoped>
@import "./index.scss";
</style>
```

**data.ts - æ•°æ®é€»è¾‘å±‚**

```typescript
import { ref, reactive } from "vue";
import { ElMessage } from "element-plus";
import { getOrderListApi } from "@/api/order";

// æœç´¢è¡¨å•
export const searchForm = reactive({
  orderNo: "",
  customerName: ""
});

// è¡¨æ ¼æ•°æ®
export const tableData = ref([]);
export const loading = ref(false);

// åˆ†é¡µ
export const pagination = reactive({
  page: 1,
  pageSize: 20,
  total: 0
});

// è·å–åˆ—è¡¨
export const fetchList = async () => {
  loading.value = true;
  try {
    const res = await getOrderListApi({
      ...searchForm,
      page: pagination.page,
      pageSize: pagination.pageSize
    });
    tableData.value = res.data.records;
    pagination.total = res.data.total;
  } catch (error) {
    ElMessage.error("è·å–åˆ—è¡¨å¤±è´¥");
  } finally {
    loading.value = false;
  }
};

// æœç´¢
export const handleSearch = () => {
  pagination.page = 1;
  fetchList();
};
```

**index.scss - æ ·å¼å±‚**

```scss
.order-list-page {
  padding: 16px;
  background-color: #f5f5f5;

  .el-card {
    margin-bottom: 16px;

    &:last-child {
      margin-bottom: 0;
    }
  }

  .el-pagination {
    margin-top: 16px;
    display: flex;
    justify-content: flex-end;
  }
}
```

### 8.3 Vue 3 ä»£ç ç»„ç»‡é¡ºåº

**æ ‡å‡†é¡ºåºï¼ˆ9 ä¸ªéƒ¨åˆ†ï¼‰**ï¼š

| é¡ºåº | éƒ¨åˆ†             | åŒ…å«å†…å®¹                                      | è¯´æ˜                       |
| ---- | ---------------- | --------------------------------------------- | -------------------------- |
| 1ï¸âƒ£   | **ç±»å‹å®šä¹‰**     | `interface`ã€`type`                           | TypeScript ç±»å‹å®šä¹‰        |
| 2ï¸âƒ£   | **ç»„ä»¶é…ç½®**     | `defineOptions`ã€`defineProps`ã€`defineEmits` | Vue ç¼–è¯‘å™¨å®               |
| 3ï¸âƒ£   | **è·¯ç”±å’Œ Store** | `useRoute`ã€`useRouter`ã€`useStore`           | å¤–éƒ¨ä¾èµ–                   |
| 4ï¸âƒ£   | **å“åº”å¼æ•°æ®**   | `ref`ã€`reactive`                             | ç»„ä»¶çŠ¶æ€æ•°æ®               |
| 5ï¸âƒ£   | **è®¡ç®—å±æ€§**     | `computed`                                    | åŸºäºæ•°æ®çš„è¡ç”Ÿå€¼           |
| 6ï¸âƒ£   | **ç›‘å¬å™¨**       | `watch`ã€`watchEffect`                        | ç›‘å¬æ•°æ®å˜åŒ–               |
| 7ï¸âƒ£   | **ç”Ÿå‘½å‘¨æœŸ**     | `onMounted`ã€`onBeforeUnmount` ç­‰             | ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­           |
| 8ï¸âƒ£   | **æ–¹æ³•å®šä¹‰**     | API è°ƒç”¨ã€äº‹ä»¶å¤„ç†ã€å·¥å…·æ–¹æ³•                  | ä¸šåŠ¡é€»è¾‘å®ç°               |
| 9ï¸âƒ£   | **æš´éœ²æ–¹æ³•**     | `defineExpose`                                | ä¾›çˆ¶ç»„ä»¶è°ƒç”¨ï¼ˆå¯é€‰ï¼‰       |

**å®Œæ•´ç¤ºä¾‹**ï¼š

```vue
<script setup lang="ts">
// ==================== 1. ç±»å‹å®šä¹‰ ====================
interface OrderItem {
  id: string;
  name: string;
  quantity: number;
}

// ==================== 2. ç»„ä»¶é…ç½® ====================
defineOptions({
  name: "SaleOrderList"
});

const props = defineProps<{
  orderId?: string;
  readonly?: boolean;
}>();

const emit = defineEmits<{
  (e: "submit", data: any): void;
  (e: "cancel"): void;
}>();

// ==================== 3. è·¯ç”±å’ŒStore ====================
import { useRoute, useRouter } from "vue-router";
import { useUserStore } from "@/stores/user";

const route = useRoute();
const router = useRouter();
const userStore = useUserStore();

// ==================== 4. å“åº”å¼æ•°æ® ====================
import { ref, reactive, computed } from "vue";

const loading = ref(false);
const tableData = ref<OrderItem[]>([]);

const formData = reactive({
  orderNo: "",
  customerName: ""
});

// ==================== 5. è®¡ç®—å±æ€§ ====================
const totalAmount = computed(() => {
  return tableData.value.reduce((sum, item) => sum + item.quantity, 0);
});

// ==================== 6. ç›‘å¬å™¨ ====================
import { watch } from "vue";

watch(
  () => props.orderId,
  (newId) => {
    if (newId) {
      fetchOrderDetail(newId);
    }
  },
  { immediate: true }
);

// ==================== 7. ç”Ÿå‘½å‘¨æœŸé’©å­ ====================
import { onMounted } from "vue";

onMounted(() => {
  fetchList();
});

// ==================== 8. æ–¹æ³•å®šä¹‰ ====================
const fetchList = async () => {
  loading.value = true;
  // ...
};

const handleSubmit = () => {
  emit("submit", formData);
};

// ==================== 9. æš´éœ²æ–¹æ³• ====================
defineExpose({
  fetchList
});
</script>
```

---

## 9. API å±‚æ¶æ„è®¾è®¡

### 9.1 é…ç½®åŒ–å¼€å‘æ¨¡å¼

**æ ¸å¿ƒç†å¿µ**ï¼š**"é›¶ API å±‚"** - é€šè¿‡é…ç½®ç›´æ¥è°ƒç”¨åŸºç±»æ–¹æ³•

**ä¼ ç»Ÿæ¨¡å¼ vs é…ç½®åŒ–æ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¼ ç»Ÿæ¨¡å¼ï¼ˆ3å±‚ï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  View (index.vue)                                       â”‚
â”‚    â†“ å¼•ç”¨                                                â”‚
â”‚  Logic (data.ts)                                        â”‚
â”‚    â†“ è°ƒç”¨                                                â”‚
â”‚  API Layer (order-api.ts)  â† éœ€è¦ç»´æŠ¤                   â”‚
â”‚    â†“ è°ƒç”¨                                                â”‚
â”‚  HTTP Utils (@jhlc/common-core)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é…ç½®åŒ–æ¨¡å¼ï¼ˆ2å±‚ï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  View (index.vue)                                       â”‚
â”‚    â†“ å¼•ç”¨                                                â”‚
â”‚  Logic + API Config (data.ts)  â† é…ç½® + åŸºç±»æ–¹æ³•        â”‚
â”‚    â†“ ç»§æ‰¿                                                â”‚
â”‚  AbstractPageQueryHook (@jhlc/common-core)              â”‚
â”‚    Â· getAction / postAction / putAction / deleteAction  â”‚
â”‚    Â· actionBatch / postBatch / putBatch / deleteBatch   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š

- âœ… **å‡å°‘æ–‡ä»¶æ•°é‡**ï¼šæ— éœ€å•ç‹¬ç»´æŠ¤ API å±‚
- âœ… **ä»£ç æ›´ç®€æ´**ï¼šé…ç½®é©±åŠ¨ï¼Œå‡å°‘é‡å¤ä»£ç 
- âœ… **å¼€å‘æ›´é«˜æ•ˆ**ï¼šä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸å…³æ³¨ HTTP å°è£…
- âœ… **æ˜“äºç»´æŠ¤**ï¼šAPI é…ç½®é›†ä¸­ç®¡ç†

### 9.2 AbstractPageQueryHook åŸºç±»

**åŸºç±»æ¦‚è¿°**ï¼š

```typescript
import { AbstractPageQueryHook } from "@jhlc/common-core";

class PageQueryHook extends AbstractPageQueryHook {
  // ç»§æ‰¿æ‰€æœ‰å†…ç½®æ–¹æ³•:
  // Â· getAction(url, params)       - GET è¯·æ±‚
  // Â· postAction(url, data)        - POST è¯·æ±‚
  // Â· putAction(url, data)         - PUT è¯·æ±‚
  // Â· deleteAction(url, data, params) - DELETE è¯·æ±‚
  // Â· actionBatch(...)              - æ‰¹é‡æ“ä½œ
  // Â· postBatch / putBatch / deleteBatch - æ‰¹é‡æ“ä½œç®€å†™
}
```

**å®Œæ•´ä½¿ç”¨ç¤ºä¾‹**ï¼š

```typescript
// data.ts
import { AbstractPageQueryHook } from "@jhlc/common-core";
import type { BaseFormItemDesc } from "@/types/jh4j-cloud";

// ==================== 1. API é…ç½® ====================
const API_CONFIG = {
  list: "/sale/order/list",
  get: "/sale/order/getById",
  save: "/sale/order/save",
  update: "/sale/order/update",
  remove: "/sale/order/remove",
  exportExcel: "/sale/order/export"
} as const;

// ==================== 2. ç»§æ‰¿åŸºç±» ====================
export class OrderQueryHook extends AbstractPageQueryHook {
  constructor() {
    super();
    
    // åˆ—è¡¨æŸ¥è¯¢é…ç½®
    this.url.list = API_CONFIG.list;
    this.url.deleteBatch = API_CONFIG.remove;
    
    // è¡¨æ ¼åˆ—é…ç½®
    this.columns = [
      { label: "è®¢å•å·", prop: "orderNo", minWidth: "120" },
      { label: "å®¢æˆ·åç§°", prop: "customerName", minWidth: "150" },
      { label: "è®¢å•é‡‘é¢", prop: "amount", minWidth: "120" },
      { label: "è®¢å•çŠ¶æ€", prop: "status", minWidth: "100" }
    ];
    
    // æœç´¢è¡¨å•é…ç½®
    this.searchFormItemDescArray = [
      { label: "è®¢å•å·", prop: "orderNo", inputType: "input" },
      { label: "å®¢æˆ·åç§°", prop: "customerName", inputType: "input" },
      { label: "è®¢å•çŠ¶æ€", prop: "status", inputType: "select", dictCode: "order_status" }
    ];
  }
  
  // ==================== 3. ä¸šåŠ¡æ–¹æ³•ï¼ˆç›´æ¥ä½¿ç”¨åŸºç±»æ–¹æ³•ï¼‰ ====================
  
  // æ–°å¢
  async handleAdd(row: any) {
    await this.postAction(API_CONFIG.save, row);
    this.getTableList(); // åˆ·æ–°åˆ—è¡¨
  }
  
  // ç¼–è¾‘
  async handleEdit(row: any) {
    await this.putAction(API_CONFIG.update, row);
    this.getTableList();
  }
  
  // åˆ é™¤ï¼ˆå•ä¸ªï¼‰
  async handleDelete(row: any) {
    await this.deleteAction(API_CONFIG.remove, {}, { ids: [row.id] });
    this.getTableList();
  }
  
  // æ‰¹é‡åˆ é™¤
  async handleBatchDelete(ids: string[]) {
    await this.actionBatch(this.deleteAction, API_CONFIG.remove, "åˆ é™¤", ids);
    this.getTableList();
  }
  
  // å¯¼å‡º
  async handleExport() {
    await this.getAction(API_CONFIG.exportExcel, this.queryParam);
  }
  
  // è·å–è¯¦æƒ…
  async fetchDetail(id: string) {
    const res = await this.getAction(API_CONFIG.get, { id });
    return res.data;
  }
}

// ==================== 4. åˆ›å»ºå®ä¾‹å¹¶å¯¼å‡º ====================
export function createPage() {
  return new OrderQueryHook();
}
```

**åœ¨ index.vue ä¸­ä½¿ç”¨**ï¼š

```vue
<script setup lang="ts">
import { createPage } from "./data";

const pageHook = createPage();

// è‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ getTableList æ–¹æ³•
onMounted(() => {
  pageHook.getTableList();
});
</script>
```

**è¯¦ç»†æ–‡æ¡£**ï¼š[AbstractPageQueryHook æœ€ä½³å®è·µ](./page-query-hook-best-practices.md)

### 9.3 API å°è£…ç­–ç•¥

**åœºæ™¯é€‰æ‹©**ï¼š

| åœºæ™¯                       | æ¨èæ–¹å¼                          | è¯´æ˜                             |
| -------------------------- | --------------------------------- | -------------------------------- |
| **æ ‡å‡† CRUD é¡µé¢**         | AbstractPageQueryHook åŸºç±»        | åˆ—è¡¨é¡µã€è¡¨å•é¡µï¼Œé…ç½®åŒ–å¼€å‘       |
| **å¤æ‚ä¸šåŠ¡é€»è¾‘**           | ç‹¬ç«‹ API æ–‡ä»¶ + è‡ªå®šä¹‰æ–¹æ³•        | éœ€è¦å¤æ‚æ•°æ®å¤„ç†ã€å¤šæ­¥éª¤æ“ä½œ     |
| **å¤šä¸ªé¡µé¢å…±äº« API**       | ç‹¬ç«‹ API æ–‡ä»¶                     | ç»Ÿä¸€ç»´æŠ¤ï¼Œä¾¿äºå¤ç”¨               |
| **ç®€å•é¡µé¢**               | ç›´æ¥åœ¨ data.ts ä¸­è°ƒç”¨åŸºç±»æ–¹æ³•     | æ— éœ€å•ç‹¬ API æ–‡ä»¶                |

**ç‹¬ç«‹ API æ–‡ä»¶ç¤ºä¾‹**ï¼ˆå¤æ‚åœºæ™¯ï¼‰ï¼š

```typescript
// src/api/order.ts
import request from "@jhlc/common-core/src/util/request";

/**
 * è·å–è®¢å•åˆ—è¡¨
 */
export function getOrderListApi(params: any) {
  return request({
    url: "/sale/order/list",
    method: "get",
    params
  });
}

/**
 * å¤æ‚ä¸šåŠ¡ï¼šè®¢å•å®¡æ‰¹ï¼ˆå¤šæ­¥éª¤ï¼‰
 */
export async function approveOrderApi(orderId: string, approveData: any) {
  // 1. æ ¡éªŒè®¢å•çŠ¶æ€
  const checkRes = await request({
    url: `/sale/order/checkStatus/${orderId}`,
    method: "get"
  });
  
  if (!checkRes.data.canApprove) {
    throw new Error("è®¢å•çŠ¶æ€ä¸å…è®¸å®¡æ‰¹");
  }
  
  // 2. æäº¤å®¡æ‰¹
  const res = await request({
    url: "/sale/order/approve",
    method: "post",
    data: { orderId, ...approveData }
  });
  
  // 3. å‘é€é€šçŸ¥
  await request({
    url: "/sale/order/sendNotification",
    method: "post",
    data: { orderId, type: "approved" }
  });
  
  return res;
}
```

---

## 10. æ„å»ºä¸éƒ¨ç½²æ¶æ„

### 10.1 å¤šç¯å¢ƒé…ç½®

**ç¯å¢ƒåˆ†ç±»**ï¼š

| ç¯å¢ƒ     | é…ç½®æ–‡ä»¶    | ç”¨é€”         | æœåŠ¡åœ°å€                         |
| -------- | ----------- | ------------ | -------------------------------- |
| **dev**  | `.env.dev`  | æœ¬åœ°å¼€å‘     | `http://172.28.99.140`           |
| **uat**  | `.env.uat`  | æµ‹è¯•ç¯å¢ƒ     | `http://172.28.99.140`           |
| **prod** | `.env.prod` | ç”Ÿäº§ç¯å¢ƒ     | `https://172.28.99.140`          |

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š

```ini
# .env.dev
ENV=dev
ENV_ANY_REPORT_SERVER=http://172.28.99.140:9999
ENV_ANY_REPORT_SECRET_KEY=your-secret-key
TOKEN_LOCALSTORAGE=tokenKey-dev
VITE_USE_MOCKJS=true
```

**vite.config.ts ä¸­ä½¿ç”¨**ï¼š

```typescript
export default defineConfig(({ mode }) => {
  const config = loadEnv(mode, process.cwd(), "ENV");
  
  const webApiMap = {
    dev: "http://172.28.99.140/uat-api",
    uat: "http://172.28.99.140/uat-api",
    prod: "https://172.28.99.140/prod-api"
  };
  
  const baseApi = "/" + config["ENV"] + "-api";
  
  return {
    define: {
      "process.env": {
        VUE_APP_BASE_API: baseApi,
        APP_NAME: "å¾®æœåŠ¡å¹³å°",
        VERSION: version,
        // ...
      }
    },
    server: {
      port: 8001,
      proxy: {
        [baseApi]: {
          target: webApiMap[config["ENV"]],
          changeOrigin: true,
          rewrite: (p) => p.replace(new RegExp(`^${baseApi}`), "")
        }
      }
    }
  };
});
```

### 10.2 æ„å»ºä¼˜åŒ–

**1. ä»£ç åˆ†å‰²**

```typescript
// vite.config.ts
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…
          "element-plus": ["element-plus"],
          "echarts": ["echarts"],
          "lodash": ["lodash"],
          
          // å…¬å…±æ¨¡å—
          "vendor": ["vue", "vue-router", "pinia"]
        }
      }
    }
  }
};
```

**2. å‹ç¼©é…ç½®**

```typescript
// vite/plugins/compression.js
import viteCompression from "vite-plugin-compression";

export default function createCompression() {
  return viteCompression({
    algorithm: "gzip", // å‹ç¼©ç®—æ³•
    ext: ".gz",        // æ–‡ä»¶åç¼€
    threshold: 10240,  // åªå‹ç¼©å¤§äº 10KB çš„æ–‡ä»¶
    deleteOriginFile: false // ä¿ç•™åŸæ–‡ä»¶
  });
}
```

**3. æŒ‰éœ€åŠ è½½**

```typescript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: "/sale/order/list",
    component: () => import("@/views/sale/order/list/index.vue")
  }
];

// ç»„ä»¶æ‡’åŠ è½½
defineAsyncComponent(() => import("./components/HeavyComponent.vue"));
```

### 10.3 éƒ¨ç½²ç­–ç•¥

**1. æ„å»ºå‘½ä»¤**

```json
{
  "scripts": {
    "build:dev": "vite build --mode dev -- --isUnionMain=true",
    "build:uat": "vite build --mode uat -- --isUnionMain=true",
    "build:prod": "vite build --mode prod -- --isUnionMain=true"
  }
}
```

**2. æ„å»ºäº§ç‰©**

```
dist/
â”œâ”€â”€ index.html                      # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ version.js                      # ç‰ˆæœ¬ä¿¡æ¯ï¼ˆå¾®å‰ç«¯ç‰ˆæœ¬åè°ƒï¼‰
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ remoteEntry.js         # Module Federationå…¥å£
â”‚   â”‚   â””â”€â”€ src-[name].[hash].js   # ä¸šåŠ¡ä»£ç 
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ [name].[hash].css      # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ img/
â””â”€â”€ ...
```

**3. Nginx é…ç½®**

```nginx
server {
  listen 80;
  server_name your-domain.com;
  
  # ä¸»åº”ç”¨
  location / {
    root /path/to/dist;
    try_files $uri $uri/ /index.html;
  }
  
  # å­åº”ç”¨
  location /sub/systemApp {
    root /path/to/systemApp/dist;
    try_files $uri $uri/ /index.html;
  }
  
  location /sub/ag-grid {
    root /path/to/ag-grid/dist;
    try_files $uri $uri/ /index.html;
  }
  
  # API ä»£ç†
  location /prod-api {
    proxy_pass http://172.28.99.140:9000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
  
  # è·¨åŸŸé…ç½®ï¼ˆå¾®å‰ç«¯éœ€è¦ï¼‰
  add_header Access-Control-Allow-Origin *;
  add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
  add_header Access-Control-Allow-Headers "Content-Type, Authorization";
}
```

**4. å¾®å‰ç«¯åè°ƒéƒ¨ç½²**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éƒ¨ç½²æ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginx (å…¥å£)                                          â”‚
â”‚    â”œâ”€â”€ / â†’ ä¸»åº”ç”¨ (cx-ui-produce)                       â”‚
â”‚    â”œâ”€â”€ /sub/systemApp â†’ ç³»ç»Ÿç®¡ç†å­åº”ç”¨                 â”‚
â”‚    â”œâ”€â”€ /sub/ag-grid â†’ é«˜çº§è¡¨æ ¼å­åº”ç”¨                   â”‚
â”‚    â””â”€â”€ /prod-api â†’ åç«¯ API                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**5. ç‰ˆæœ¬ç®¡ç†**

```typescript
// dist/version.jsï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
window.__MICRO_APP_VERSION__ = {
  module: "main_app",
  version: "2026-2-4 10:30:00",
  remoteEntry: "assets/remoteEntry.js",
  pageNum: "12"
};
```

**6. ç°åº¦å‘å¸ƒ**

```nginx
# ç°åº¦å‘å¸ƒé…ç½®ï¼ˆåŸºäºè¯·æ±‚å¤´ï¼‰
map $http_x_gray_flag $gray_backend {
  "true" http://172.28.99.140:9001; # ç°åº¦æœåŠ¡å™¨
  default http://172.28.99.140:9000; # æ­£å¼æœåŠ¡å™¨
}

server {
  location /prod-api {
    proxy_pass $gray_backend;
  }
}
```
---

## ğŸ¯ æ€»ç»“

æœ¬æ¶æ„è®¾è®¡æ–‡æ¡£åŸºäº **cx-ui-produce** é¡¹ç›®çš„å®é™…æƒ…å†µï¼Œæç‚¼äº†ä»¥ä¸‹æ ¸å¿ƒè®¾è®¡ï¼š

1. **äº§å“åŒ–æ¶æ„**ï¼šä¸€å¥—ä»£ç ï¼Œå¤šå¤„éƒ¨ç½²ï¼ŒæŒ‰éœ€ç»„è£…
2. **å¾®å‰ç«¯æ¶æ„**ï¼šModule Federation å®ç°åº”ç”¨é—´é€šä¿¡å’Œå…±äº«
3. **é¢†åŸŸé©±åŠ¨è®¾è®¡**ï¼šDDD æ¶æ„ï¼Œæ¸…æ™°çš„é¢†åŸŸåˆ’åˆ†
4. **é…ç½®åŒ–å¼€å‘**ï¼šAbstractPageQueryHook åŸºç±»ï¼Œé›¶ API å±‚å¼€å‘
5. **è§„èŒƒåŒ–å¼€å‘**ï¼šç»Ÿä¸€çš„å‘½åã€ç»„ç»‡ã€é€šä¿¡è§„èŒƒ
6. **å·¥ç¨‹åŒ–ä½“ç³»**ï¼šå®Œå–„çš„æ„å»ºã€éƒ¨ç½²ã€ç‰ˆæœ¬ç®¡ç†

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

- âœ… å¿«é€Ÿå¼€å‘ï¼šé…ç½®åŒ–å¼€å‘ï¼Œå‡å°‘é‡å¤ä»£ç 
- âœ… æ˜“äºç»´æŠ¤ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ŒèŒè´£æ˜ç¡®
- âœ… çµæ´»æ‰©å±•ï¼šå¾®å‰ç«¯æ¶æ„ï¼ŒæŒ‰éœ€ç»„è£…
- âœ… é«˜åº¦å¤ç”¨ï¼šç»„ä»¶åŒ–è®¾è®¡ï¼Œä»£ç å¤ç”¨ç‡é«˜
- âœ… å›¢é˜Ÿåä½œï¼šç»Ÿä¸€è§„èŒƒï¼Œé™ä½æ²Ÿé€šæˆæœ¬
---


